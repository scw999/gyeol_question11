

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>결하다 - 삼중뇌 & Big 5 심층 궁합</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Noto+Serif+KR:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-bg: #FDFBF7;
            --accent-gold: #C5A47E;
            --text-main: #2C2C2C;
            --male-color: #5D7D9A;
            --female-color: #D67D88;
            --destiny-red: #E11D48;
            --header-bg: linear-gradient(135deg, #FFF8F8 0%, #FFF0EB 100%);
        }
        body { font-family: 'Noto Sans KR', sans-serif; background-color: var(--primary-bg); color: var(--text-main); }
        h1, h2, h3, h4, .serif-font { font-family: 'Noto Serif KR', serif; }

        .bg-texture {
            background-color: #fcfbf9;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d1d5db' fill-opacity='0.2'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        /* 카드 스타일 */
        .question-card { 
            background: white; border: 1px solid #EAEAEA; border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.03); transition: all 0.3s ease;
            position: relative; overflow: hidden; margin-bottom: 24px;
        }
        .question-card.error {
            border: 2px solid #EF4444; animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        .question-card:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,0.06); border-color: var(--accent-gold); }

        /* 섹션 헤더 */
        .section-header {
            margin: 40px 0 20px; padding: 20px; background: white; border-radius: 16px;
            border-left: 5px solid var(--accent-gold); box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        .section-brain-icon { font-size: 2rem; margin-bottom: 10px; display: block; }
        .section-title { font-size: 1.2rem; font-weight: 700; color: #333; font-family: 'Noto Serif KR', serif; }
        .section-desc { font-size: 0.85rem; color: #666; margin-top: 5px; line-height: 1.5; }
        
        /* 라디오 버튼 */
        input[type="radio"].hidden-radio { appearance: none; position: absolute; opacity: 0; pointer-events: none; }
        .option-label { 
            display: block; padding: 16px; border-radius: 12px; border: 1px solid #f0f0f0;
            background: #fff; color: #555; font-size: 0.95rem; cursor: pointer;
            transition: all 0.2s ease; position: relative; line-height: 1.5;
        }
        .hidden-radio:checked + .option-label {
            background-color: #FAF5EB; border-color: var(--accent-gold); color: #3e2723;
            font-weight: 600; box-shadow: 0 0 0 1px var(--accent-gold) inset;
        }
        .hidden-radio:checked + .option-label::after {
            content: '✔'; position: absolute; right: 16px; top: 50%; transform: translateY(-50%);
            color: var(--accent-gold); font-weight: bold;
        }

        /* 심화 질문 영역 */
        .dynamic-area {
            background-color: #fdfbf7; border-top: 1-px dashed #e5e7eb; margin-top: 16px; padding: 20px;
            animation: slideDown 0.3s ease-out forwards;
        }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* 뱃지 스타일 */
        .type-badge { font-size: 0.65rem; padding: 3px 8px; border-radius: 4px; font-weight: 700; letter-spacing: 0.5px; text-transform: uppercase; display: inline-block; }
        .badge-crossover { background: #F3E8FF; color: #7C3AED; border: 1px solid #DDD6FE; } 
        .badge-dynamic { background: #FFF7ED; color: #C2410C; border: 1px solid #FFEDD5; } 
        .badge-similarity { background: #F1F5F9; color: #475569; border: 1px solid #E2E8F0; }
        .badge-preference { background: #ECFDF5; color: #047857; border: 1px solid #A7F3D0; }

        /* --- Result UI --- */
        .match-screen-container {
            background: #fff;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
            padding-bottom: 40px;
            margin-bottom: 40px;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        /* 매칭 헤더 */
        .match-header {
            background: var(--header-bg);
            padding: 50px 20px 80px;
            color: #333;
            position: relative;
            overflow: hidden;
        }
        .match-header::before {
            content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.08'/%3E%3C/svg%3E");
            opacity: 0.5; pointer-events: none;
        }

        /* 매칭 타입 비주얼 카드 */
        .match-type-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.8);
            border-radius: 20px;
            padding: 24px 30px;
            display: inline-block;
            margin-bottom: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.03);
            animation: slideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            position: relative; z-index: 2;
        }
        .match-icon-large {
            font-size: 3.5rem; display: block; margin-bottom: 10px;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
        }
        .match-title {
            font-family: 'Noto Serif KR', serif;
            font-size: 2rem; font-weight: 900; letter-spacing: -0.05em; color: #1F2937;
            line-height: 1.2;
        }
        .match-subtitle {
            font-size: 0.8rem; font-weight: 700; color: #9CA3AF;
            letter-spacing: 0.2em; text-transform: uppercase;
            margin-top: 6px;
        }
        .match-tags {
            margin-top: 14px; display: flex; gap: 6px; justify-content: center;
        }
        .match-tag-pill {
            background: #fff; border: 1px solid #e5e7eb; color: #666;
            padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 600;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }

        /* 프로필 이미지 영역 (간결화) */
        .profile-match-area {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: -50px;
            gap: 40px; /* 실이 보일 공간 확보 */
            position: relative;
            z-index: 10;
        }
        .profile-circle {
            width: 70px; height: 70px;
            border-radius: 50%;
            background: #fff;
            /* 테두리 대신 은은한 그림자 */
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); 
            display: flex; align-items: center; justify-content: center;
            font-size: 0; /* 텍스트/이모지 숨김 */
            position: relative;
            z-index: 2;
            transition: transform 0.5s ease, box-shadow 0.5s ease;
        }
        
        /* 연결선 (결의 흐름) 스타일 */
        .connection-container {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 240px; height: 100px;
            z-index: 1;
            pointer-events: none;
        }
        .connection-path {
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            opacity: 0.8;
            stroke-dasharray: 400;
            stroke-dashoffset: 400;
            animation: connectFlow 2.5s cubic-bezier(0.2, 1, 0.3, 1) forwards;
        }
        /* 여러 가닥의 선이 시간차를 두고 그려짐 */
        .path-1 { stroke-width: 3; animation-delay: 0.3s; }
        .path-2 { stroke-width: 1.5; animation-delay: 0.5s; opacity: 0.6; }
        .path-3 { stroke-width: 1; animation-delay: 0.7s; opacity: 0.4; }

        @keyframes connectFlow {
            to { stroke-dashoffset: 0; }
        }

        /* 매칭 데이터 요약 */
        .match-stats {
            margin-top: 30px;
            padding: 0 20px;
        }
        
        /* 파동 애니메이션 영역 */
        .resonance-container {
            margin-top: 40px;
            padding: 0 10px;
            text-align: center;
        }
        .resonance-title {
            font-size: 0.85rem; font-weight: 700; color: #6b7280; 
            text-transform: uppercase; letter-spacing: 1.5px;
            margin-bottom: 12px; display: block;
        }
        .resonance-canvas-wrapper {
            width: 100%; 
            height: 320px; /* 충분한 높이 확보 */
            background: linear-gradient(180deg, rgba(255,255,255,0) 0%, rgba(243,244,246,0.6) 50%, rgba(255,255,255,0) 100%);
            position: relative;
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 16px;
            border: 1px solid rgba(0,0,0,0.03);
            /* 캔버스 정렬을 위한 Flex */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        /* 캔버스가 wrapper에 딱 맞게 들어가도록 설정 */
        .resonance-canvas-wrapper canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        .resonance-desc {
            font-family: 'Noto Serif KR', serif;
            font-size: 1.1rem; color: #374151; font-weight: 600;
            line-height: 1.5;
            word-break: keep-all;
        }

        /* --- 호환성 분석 UI 리디자인 (텍스트 중심) --- */
        .compatibility-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            max-width: 500px;
            margin: 40px auto 30px;
            text-align: left;
        }
        @media (min-width: 640px) {
            .compatibility-grid { grid-template-columns: 1fr 1fr 1fr; }
        }

        .comp-card {
            background: #fff;
            border: 1px solid #f0f0f0;
            border-radius: 16px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.02);
            transition: transform 0.2s;
        }
        .comp-card:hover { transform: translateY(-2px); }
        
        .comp-icon { font-size: 1.8rem; margin-bottom: 8px; }
        .comp-label { 
            font-size: 0.8rem; font-weight: 700; color: #888; 
            text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px; 
        }
        .comp-status {
            font-family: 'Noto Serif KR', serif;
            font-size: 0.9rem; font-weight: 700; color: #333;
            line-height: 1.3;
            background: #f9fafb; padding: 8px 10px; border-radius: 8px; width: 100%;
            word-break: keep-all;
            min-height: 3.5em; /* 두 줄 텍스트 공간 확보 */
            display: flex; align-items: center; justify-content: center;
        }
        .comp-status.perfect { color: #059669; background: #ECFDF5; }
        .comp-status.good { color: #2563EB; background: #EFF6FF; }
        .comp-status.diff { color: #D97706; background: #FFFBEB; }
        .comp-status.unique { color: #7C3AED; background: #F5F3FF; }
        
        /* 등급별 컬러 */
        .rating-perfect { color: #10B981; background: #ECFDF5; }
        .rating-good { color: #3B82F6; background: #EFF6FF; }
        .rating-diff { color: #F59E0B; background: #FFFBEB; }
        .rating-bad { color: #EF4444; background: #FEF2F2; }

        /* --- 솔루션 카드 리디자인 --- */
        .solution-section {
            margin-top: 40px; text-align: left; padding: 0 10px;
        }
        .solution-header {
            text-align: center; margin-bottom: 20px;
        }
        .solution-title-badge {
            background: #EEF2FF; color: #4F46E5; font-size: 0.75rem; font-weight: 700;
            padding: 4px 12px; border-radius: 20px; display: inline-block; margin-bottom: 8px;
        }
        .solution-main-title {
            font-family: 'Noto Serif KR', serif; font-size: 1.4rem; font-weight: 800; color: #1F2937;
        }

        .solution-card {
            background: #fff; border-radius: 16px; border: 1px solid #f0f0f0;
            padding: 20px; margin-bottom: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.03);
            transition: transform 0.3s ease;
        }
        .solution-card:hover { transform: translateY(-2px); }
        .sol-icon-circle {
            width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; margin-bottom: 12px;
        }
        .sol-title { font-weight: 700; font-size: 1rem; margin-bottom: 8px; color: #333; }
        .sol-desc { font-size: 0.9rem; color: #555; line-height: 1.6; word-break: keep-all; }
        
        /* 솔루션 테마별 컬러 */
        .sol-conflict .sol-icon-circle { background: #FEF2F2; color: #DC2626; }
        .sol-conflict { border-left: 4px solid #DC2626; }
        
        .sol-talk .sol-icon-circle { background: #F0F9FF; color: #0284C7; }
        .sol-talk { border-left: 4px solid #0284C7; }

        .sol-date .sol-icon-circle { background: #FFFBEB; color: #D97706; }
        .sol-date { border-left: 4px solid #D97706; }

        /* 레이더 차트 분석 텍스트 스타일 */
        .radar-analysis-box {
            display: flex; flex-direction: column; justify-content: center; height: 100%;
            padding-left: 0; margin-top: 20px;
        }
        @media (min-width: 768px) {
            .radar-analysis-box { padding-left: 20px; margin-top: 0; border-left: 1px dashed #eee; }
        }
        .analysis-item { margin-bottom: 20px; }
        .analysis-label { font-size: 0.8rem; color: #999; font-weight: 700; uppercase; letter-spacing: 0.5px; display: block; margin-bottom: 6px; }
        .analysis-content { font-size: 0.95rem; color: #333; font-weight: 500; line-height: 1.5; }
        .analysis-highlight { color: #E11D48; font-weight: 700; }

        /* 개인 분석 박스 */
        .personal-analysis-box {
            background: #fff; border: 1px solid #eee; border-radius: 16px; padding: 24px; margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.03);
        }
        .personal-title {
            font-size: 1.1rem; font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; border-bottom: 1px solid #f0f0f0; padding-bottom: 10px;
        }
        .personal-desc { font-size: 0.9rem; color: #555; line-height: 1.6; }
        
        /* 스탯 바 스타일 */
        .stat-row { display: flex; align-items: center; margin-bottom: 10px; font-size: 0.85rem; }
        .stat-label { width: 80px; font-weight: 600; color: #666; }
        .stat-track { flex: 1; height: 8px; background: #f0f0f0; border-radius: 4px; overflow: hidden; margin: 0 10px; }
        .stat-fill { height: 100%; border-radius: 4px; transition: width 1s ease-in-out; }
        .stat-value { width: 40px; text-align: right; font-weight: bold; color: #888; font-size: 0.8rem; }
        .male .stat-fill { background: var(--male-color); }
        .female .stat-fill { background: var(--female-color); }

        /* 애니메이션 키프레임 */
        @keyframes scaleUp { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in-up { animation: slideUp 0.8s ease-out forwards; opacity: 0; }
        .text-gradient { background: linear-gradient(45deg, #5D7D9A, #D67D88); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* 모달 스타일 */
        #science-modal, #analysis-guide-modal { backdrop-filter: blur(5px); }
        .modal-content { max-height: 80vh; overflow-y: auto; scrollbar-width: thin; }
        .theory-box {
            border: 1px solid #e5e7eb; background-color: #f9fafb; border-radius: 8px; padding: 16px;
            margin-top: 10px; margin-bottom: 20px;
        }
        .theory-title { font-weight: bold; color: #1e3a8a; margin-bottom: 4px; display: block; }
        
        /* 매칭 리스트 (새로운 카드형 UI) */
        .match-card {
            background: #fff; border-radius: 12px; padding: 16px; margin-bottom: 12px;
            border-left: 4px solid transparent;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03);
            display: flex; flex-direction: column; gap: 8px;
            transition: transform 0.2s ease;
        }
        .match-card:hover { transform: translateY(-2px); }
        
        .match-card-header { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; }
        .match-badge { 
            font-size: 0.7rem; font-weight: 800; padding: 4px 8px; border-radius: 6px; 
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        .match-card-q { font-size: 0.95rem; font-weight: 700; color: #1F2937; }
        .match-card-a { 
            background: #F9FAFB; padding: 10px; border-radius: 8px; 
            font-size: 0.85rem; color: #4B5563; font-weight: 500;
            display: flex; align-items: center; gap: 6px;
        }
        .match-card-a::before { content: 'A.'; color: #9CA3AF; font-weight: 700; }

        /* 매칭 타입별 테마 */
        /* 1. 상호 보완 (Crossover) - Pink/Orange */
        .type-crossover { border-left-color: #E11D48; background: #FFF1F2; }
        .type-crossover .match-badge { background: #FFE4E6; color: #BE123C; border: 1px solid #FDA4AF; }
        .type-crossover .match-card-a { background: #fff; border: 1px solid #FECDD3; color: #9F1239; }
        
        /* 2. 취향 일치 (Similarity) - Yellow/Blue */
        .type-similarity { border-left-color: #F59E0B; background: #FFFBEB; }
        .type-similarity .match-badge { background: #FEF3C7; color: #B45309; border: 1px solid #FDE68A; }
        .type-similarity .match-card-a { background: #fff; border: 1-px solid #FCD34D; color: #92400E; }
        
        /* 3. 동적 조화 (Dynamic) - Purple */
        .type-dynamic { border-left-color: #7C3AED; background: #F5F3FF; }
        .type-dynamic .match-badge { background: #EDE9FE; color: #6D28D9; border: 1px solid #DDD6FE; }
        .type-dynamic .match-card-a { background: #fff; border: 1px solid #C4B5FD; color: #5B21B6; }
        
        /* 4. 가치관 (Preference) - Green */
        .type-preference { border-left-color: #059669; background: #ECFDF5; }
        .type-preference .match-badge { background: #D1FAE5; color: #047857; border: 1px solid #6EE7B7; }
        .type-preference .match-card-a { background: #fff; border: 1px solid #6EE7B7; color: #065F46; }


        /* 하단 고정 버튼 바 */
        .fixed-bottom-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            border-top: 1px solid #e5e7eb; padding: 16px; z-index: 50;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.05);
        }
        
        /* 스페셜 뱃지 컨테이너 */
        .special-badge-container {
            display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin: 24px 0;
        }
        .chem-badge {
            display: inline-flex; align-items: center; padding: 8px 16px; border-radius: 30px;
            font-size: 0.8rem; font-weight: 700; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            background: #fff; border: 1px solid #eee; color: #555;
            animation: slideUp 0.5s forwards; opacity: 0; transform: translateY(10px);
        }
        .chem-badge.money { background: #ECFDF5; color: #047857; border-color: #A7F3D0; }
        .chem-badge.love { background: #FFF1F2; color: #BE123C; border-color: #FECDD3; }
        .chem-badge.life { background: #F0F9FF; color: #0369A1; border-color: #BAE6FD; }
        .chem-badge.talk { background: #F5F3FF; color: #7C3AED; border-color: #DDD6FE; }
        .chem-badge.values { background: #FFFBEB; color: #B45309; border-color: #FDE68A; }
        
        /* 요약 박스 */
        .summary-box {
            background: #F8FAFC; border-radius: 16px;
            padding: 20px; margin: 0 20px 20px; text-align: left;
            border: 1px solid #F1F5F9;
        }
        .summary-title { font-weight: 700; color: #334155; font-size: 0.9rem; margin-bottom: 10px; display: block; }
        .summary-item { display: flex; align-items: flex-start; margin-bottom: 8px; font-size: 0.9rem; color: #475569; }
        .summary-item::before { content: '✨'; margin-right: 8px; }
        
        /* Chemistry 상세 스타일 */
        .chem-detail-card {
            background: #fff; border-radius: 16px; border: 1px solid #f3f4f6;
            padding: 0; overflow: hidden; text-align: left;
        }
        .chem-detail-header {
            padding: 16px 20px; background: #f9fafb; border-bottom: 1px solid #f3f4f6;
            font-weight: 700; color: #1f2937; display: flex; align-items: center; gap: 8px;
        }
        .chem-detail-body { padding: 20px; }
        .chem-point { margin-top: 12px; padding: 12px; background: #fffbeb; border-radius: 8px; font-size: 0.85rem; color: #92400e; border: 1px solid #fef3c7; }
        /* Caution -> Advice (Blue) */
        .chem-advice { margin-top: 8px; padding: 12px; background: #eff6ff; border-radius: 8px; font-size: 0.85rem; color: #1e40af; border: 1px solid #dbeafe; }
    </style>
</head>
<body class="bg-texture min-h-screen text-gray-800 pb-32">
    
    <nav class="w-full py-5 px-6 border-b border-gray-100 bg-white/80 backdrop-blur-sm fixed top-0 z-40">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="text-2xl font-black serif-font tracking-tighter cursor-pointer" onclick="window.location.reload()">
                결<span class="text-sm font-light text-gray-400 ml-1 font-sans">하다</span>
            </div>
            <div class="text-[10px] md:text-xs text-gray-500 tracking-widest block">결을 잇다</div>
        </div>
    </nav>

    <div id="main-container" class="container mx-auto p-4 pt-28 max-w-5xl">
        
        <!-- 인트로 -->
        <header id="intro-section" class="text-center mb-12 py-8">
            <div class="inline-block mb-4 px-4 py-1 rounded-full bg-indigo-50 border border-indigo-100 text-indigo-800 text-xs font-bold tracking-wider shadow-sm">
                🧠 Big 5 성격 이론 & 삼중뇌 분석
            </div>
            <h1 class="text-3xl md:text-5xl font-bold mb-6 text-gray-800 leading-tight serif-font">
                본능부터 성격까지,<br>우리의 <span class="italic text-gradient">결</span>은 얼마나 닮았을까?
            </h1>
            <p class="mt-4 text-gray-600 max-w-xl mx-auto leading-relaxed font-light text-sm md:text-base break-keep">
                현대 심리학의 <b>Big 5 성격 요인</b>과 <b>애착 이론</b>을 결합했습니다.<br>
                단순한 취향을 넘어 기질적 조화와 결혼 생활의 안정성을 예측하는<br>
                <b>심층 매칭 시스템</b>으로 서로를 깊이 알아보세요.
            </p>
            <button onclick="openModal('science-modal')" class="mt-6 text-xs text-gray-400 underline hover:text-gray-600 transition-colors">
                이 매칭의 과학적 근거가 궁금하신가요?
            </button>
        </header>

        <!-- 질문 섹션 -->
        <div id="question-section" class="fade-in-up">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-12 relative">
                <div class="hidden lg:block absolute left-1/2 top-0 bottom-0 w-px bg-gray-200 -ml-px"></div>

                <!-- 남자 질문 -->
                <div>
                    <div class="sticky top-24 bg-white/90 backdrop-blur p-4 rounded-xl border border-gray-100 shadow-sm mb-6 z-20 text-center">
                        <h2 class="text-xl font-bold text-blue-900 serif-font flex items-center justify-center">
                            <!-- 이모지 제거 -->
                            예비 신랑
                        </h2>
                    </div>
                    <div id="male-questions" class="space-y-6 px-1"></div>
                </div>

                <!-- 여자 질문 -->
                <div>
                    <div class="sticky top-24 bg-white/90 backdrop-blur p-4 rounded-xl border border-gray-100 shadow-sm mb-6 z-20 text-center">
                        <h2 class="text-xl font-bold text-pink-900 serif-font flex items-center justify-center">
                            <!-- 이모지 제거 -->
                            예비 신부
                        </h2>
                    </div>
                    <div id="female-questions" class="space-y-6 px-1"></div>
                </div>
            </div>
        </div>

        <!-- 결과 화면 -->
        <div id="results" class="hidden fade-in-up">
            
            <!-- 1. 리포트 헤더 & 매칭 유형 비주얼 -->
            <div class="max-w-2xl mx-auto bg-white rounded-3xl shadow-lg overflow-hidden border border-gray-100 mb-12">
                <!-- 헤더 -->
                <div class="match-header">
                    <div class="text-center relative z-10">
                        <!-- 매칭 타입 카드 (JS로 동적 생성) -->
                        <div id="match-type-card-container"></div>
                        <h2 class="match-title mt-4" id="couple-title">결혼 궁합 리포트</h2>
                        <p class="match-subtitle" id="result-keyword">두 분의 심층 분석 결과가 도착했습니다</p>
                    </div>
                </div>

                <!-- 프로필 매칭 (Red Thread) -->
                <div class="profile-match-area">
                    <!-- 이모지 제거, JS에서 배경색 적용 -->
                    <div class="profile-circle" id="result-circle-male"></div>
                    
                    <!-- 연결선 SVG (Gradient Definition 포함) -->
                    <div class="connection-container">
                        <svg viewBox="0 0 240 80" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <defs id="connection-defs"></defs> <!-- JS로 그라데이션 주입 -->
                            <!-- 물결처럼 연결되는 선들 -->
                            <path class="connection-path path-1" d="M20 40 C 80 10, 160 70, 220 40" stroke="url(#match-gradient)" />
                            <path class="connection-path path-2" d="M20 40 C 80 70, 160 10, 220 40" stroke="url(#match-gradient)" />
                            <path class="connection-path path-3" d="M20 40 C 80 40, 160 40, 220 40" stroke="url(#match-gradient)" />
                        </svg>
                    </div>
                    
                    <!-- 이모지 제거, JS에서 배경색 적용 -->
                    <div class="profile-circle" id="result-circle-female"></div>
                </div>

                <div class="p-8 text-center">
                    <div class="match-stats">
                        
                        <!-- 관계의 파동 (색상 그라데이션 적용) -->
                        <div class="resonance-container">
                            <div class="flex justify-center items-center gap-2 mb-3">
                                <span class="resonance-title mb-0">Relationship Resonance</span>
                                <button onclick="openSpecificGuide('resonance')" class="text-xs text-gray-400 underline hover:text-gray-600">
                                    [🌊 이 파동은 뭘까?]
                                </button>
                            </div>
                            <div class="resonance-canvas-wrapper">
                                <canvas id="resonanceWaveCanvas"></canvas>
                            </div>
                            <p id="resonance-desc" class="resonance-desc"></p>
                        </div>

                        <!-- 3대 핵심 호환성 (텍스트 카드형 리디자인) -->
                        <div class="compatibility-grid">
                            <div class="comp-card">
                                <span class="comp-icon">🦎</span>
                                <span class="comp-label">Lifestyle</span>
                                <div id="card-life-text" class="comp-status">분석중</div>
                            </div>
                            <div class="comp-card">
                                <span class="comp-icon">❤️</span>
                                <span class="comp-label">Emotion</span>
                                <div id="card-love-text" class="comp-status">분석중</div>
                            </div>
                            <div class="comp-card">
                                <span class="comp-icon">🧠</span>
                                <span class="comp-label">Values</span>
                                <div id="card-value-text" class="comp-status">분석중</div>
                            </div>
                        </div>
                        
                        <div id="special-badges" class="special-badge-container"></div>

                        <!-- 핵심 요약 -->
                        <div class="summary-box">
                            <span class="summary-title">📋 매칭 리포트 요약</span>
                            <div id="result-summary" class="space-y-1"></div>
                        </div>

                        <!-- 상세 분석 코멘트 -->
                        <div class="bg-gray-50 p-6 rounded-xl text-gray-700 leading-relaxed break-keep text-left border border-gray-100 text-sm">
                            <div id="result-detailed-text" class="space-y-4 font-light"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 2. 개인별 심층 분석 (그래프 포함) -->
            <div class="max-w-5xl mx-auto mb-12">
                <div class="text-center mb-8">
                    <span class="text-xs font-bold text-indigo-500 tracking-widest uppercase mb-2 block">In-depth Personal Analysis</span>
                    <h3 class="text-2xl font-bold serif-font text-gray-800">개인별 Big 5 & 애착 8대 성향 분석</h3>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- 남자 분석 -->
                    <div class="personal-analysis-box border-l-4 border-l-blue-400 male">
                        <div class="personal-title text-blue-800 justify-between">
                            <span>🤵‍♂️ 예비 신랑 상세 분석</span>
                            <span id="male-attachment-badge" class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-lg">분석중</span>
                        </div>
                        <!-- [MODIFIED] Removed bar chart, will be replaced by top3 text list -->
                        <div id="male-stat-container" class="mb-6"></div>
                        <div id="male-personal-text" class="personal-desc bg-blue-50/50 p-4 rounded-xl text-sm border border-blue-100"></div>
                    </div>
                    
                    <!-- 여자 분석 -->
                    <div class="personal-analysis-box border-l-4 border-l-pink-400 female">
                        <div class="personal-title text-pink-800 justify-between">
                            <span>👰‍♀️ 예비 신부 상세 분석</span>
                            <span id="female-attachment-badge" class="text-xs bg-pink-100 text-pink-800 px-2 py-1 rounded-lg">분석중</span>
                        </div>
                        <!-- [MODIFIED] Removed bar chart -->
                        <div id="female-stat-container" class="mb-6"></div>
                        <div id="female-personal-text" class="personal-desc bg-pink-50/50 p-4 rounded-xl text-sm border border-pink-100"></div>
                    </div>
                </div>
            </div>

            <!-- 3. 관계 화학 작용 -->
            <div class="max-w-4xl mx-auto bg-gray-50 rounded-2xl p-8 mb-12 border border-gray-200">
                <div class="text-center mb-6">
                    <h3 class="text-xl font-bold serif-font text-gray-800">🧪 관계의 화학작용 (Chemistry)</h3>
                </div>
                <div id="chemistry-analysis" class="text-sm text-gray-700 leading-relaxed space-y-3"></div>
            </div>

            <!-- 4. Big 5 + 애착 다각형 분석 -->
            <div class="max-w-4xl mx-auto radar-box mb-12">
                <div class="text-center mb-8">
                    <span class="text-xs font-bold text-indigo-500 tracking-widest uppercase mb-2 block">Personality Spectrum</span>
                    <div class="flex justify-center items-center gap-2">
                        <h3 class="text-2xl font-bold serif-font text-gray-800">성격 & 애착 8각형 시각화</h3>
                        <button onclick="openSpecificGuide('radar')" class="text-xs text-gray-400 underline hover:text-gray-600 self-end mb-1">
                            [📊 그래프 해석 가이드]
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-10 items-center">
                    <div class="relative h-80 w-full flex justify-center items-center"> 
                        <canvas id="comparisonRadarChart"></canvas>
                    </div>
                    
                    <div class="radar-analysis-box px-6 md:px-0 md:border-l border-gray-100" id="radar-analysis-content">
                        <!-- JS Generated Content -->
                    </div>
                </div>
            </div>
            
            <!-- 5. 심층 성향 일치도 분석 (New Card Layout) -->
            <div class="max-w-2xl mx-auto mb-12">
                <div class="bg-white p-8 rounded-3xl border border-gray-100 shadow-lg relative overflow-hidden">
                    <!-- 데코레이션 -->
                    <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-100 via-purple-100 to-pink-100"></div>
                    
                    <h4 class="font-bold text-xl text-gray-800 mb-2 flex items-center justify-center">
                        <span class="mr-2">🔍</span> 심층 성향 일치도 분석 (Detailed Analysis)
                    </h4>
                    <p class="text-center text-xs text-gray-400 mb-8 font-light">두 분의 답변을 분석하여 가장 잘 맞는 부분들을 시각화했습니다.</p>
                    
                    <div id="integrated-match-list" class="flex flex-col gap-3">
                        <!-- JS로 동적 생성 (Card UI) -->
                    </div>
                </div>
            </div>

            <!-- 6. 종합 솔루션 (New Design) -->
            <div class="max-w-4xl mx-auto solution-section">
                <div class="solution-header">
                    <span class="solution-title-badge">TOTAL SOLUTION</span>
                    <h3 class="solution-main-title">두 분을 위한 맞춤형 처방전</h3>
                    <p class="text-gray-500 text-sm mt-2">분석 데이터를 기반으로 구체적인 행동 가이드를 제안합니다.</p>
                </div>
                
                <div id="solution-cards-container">
                    <!-- JS로 동적 생성됨 -->
                </div>
            </div>
            
            <!-- 7. 종합 결론 (복구됨) -->
            <div class="max-w-2xl mx-auto mt-12 bg-indigo-50 p-8 rounded-3xl text-center border border-indigo-100">
                <h3 class="text-lg font-bold text-indigo-900 mb-4">✨ 결하다 종합 결론</h3>
                <p id="final-conclusion" class="text-indigo-800 text-sm leading-7 font-medium"></p>
            </div>
        </div>
    </div>

    <!-- 하단 고정 버튼 바 -->
    <div class="fixed-bottom-bar">
        <div class="max-w-5xl mx-auto relative flex justify-center items-center">
            <div id="warning-message" class="absolute -top-16 left-0 right-0 text-center text-white text-sm font-bold bg-gray-800/90 py-3 rounded-full shadow-lg mx-auto w-72 hidden animate-bounce backdrop-blur">
                ⚠️ 모든 질문에 답변해주세요!
            </div>
            
            <div class="flex gap-3 w-full max-w-md justify-center">
                <button type="button" id="random-btn" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-600 font-bold py-4 px-6 rounded-xl transition-colors text-sm">
                    🎲 랜덤(Test)
                </button>
                <button type="button" id="calculate-btn" class="flex-[2] bg-gray-900 hover:bg-gray-800 text-white font-bold py-4 px-10 rounded-xl shadow-lg transform transition active:scale-95 flex items-center justify-center text-base">
                    <span>✨ 심층 분석 리포트 확인하기</span>
                </button>
            </div>
            <div class="w-full max-w-md mt-2 hidden" id="retry-container">
                <button type="button" id="retry-btn" class="w-full bg-white border border-gray-300 hover:bg-gray-50 text-gray-800 font-bold py-4 px-12 rounded-xl shadow-sm transition-all">
                    처음부터 다시하기
                </button>
            </div>
        </div>
    </div>

    <!-- 과학적 근거 모달 -->
    <div id="science-modal" class="fixed inset-0 bg-black/50 hidden z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-2xl modal-content shadow-2xl transform transition-all scale-95 opacity-0" id="science-modal-panel">
            <div class="p-8">
                <div class="flex justify-between items-start mb-6">
                    <h3 class="text-2xl font-bold serif-font text-gray-800">과학적 분석 근거 & 출처</h3>
                    <button onclick="closeModal('science-modal')" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                </div>
                
                <div class="space-y-6 text-sm leading-relaxed text-gray-600">
                    <div>
                        <h4 class="font-bold text-indigo-600 mb-2 text-lg">1. 폴 맥린의 삼중뇌 이론 (Triune Brain)</h4>
                        <p class="mb-2">1960년대 신경과학자 폴 맥린(Paul MacLean)의 이론을 현대적으로 재해석하여, 결혼 생활의 3가지 층위(본능/감정/이성)를 분석합니다.</p> 
                        <ul class="list-disc list-inside space-y-1 ml-2 bg-gray-50 p-4 rounded-lg text-xs">
                            <li><b>🦎 파충류의 뇌 (생존):</b> 수면, 식습관, 위생, 에너지 등 기초 생활 습관과 생존 본능</li>
                            <li><b>❤️ 포유류의 뇌 (감정):</b> 애착, 친밀감, 공감 능력, 정서적 유대와 갈등 해결</li>
                            <li><b>🧠 영장류의 뇌 (이성):</b> 경제관, 자녀 계획, 커리어, 미래 설계 등 이성적 판단</li>
                        </ul>
                    </div>

                    <div>
                        <h4 class="font-bold text-indigo-600 mb-2 text-lg">2. 현대 심리학의 거장들과 적용된 질문</h4>
                        <p class="mb-4">단순한 성격 검사를 넘어, 관계 심리학의 권위 있는 이론들을 각 질문 항목에 구체적으로 매핑했습니다.</p>
                        
                        <div class="theory-box">
                            <span class="theory-title">🛡️ 애착 이론 (Attachment Theory) - 존 볼비</span>
                            <p class="mb-2 text-xs text-gray-500">영국의 정신분석학자 <b>존 볼비(John Bowlby)</b>가 창시했습니다. 어린 시절 양육자와의 관계가 성인기 연애와 결혼 생활의 안정성을 결정한다는 이론입니다.</p>
                            <div class="mt-2 pt-2 border-t border-gray-200">
                                <p class="font-bold text-xs text-indigo-800 mb-1">📌 반영된 핵심 질문:</p>
                                <ul class="list-none space-y-1 text-xs ml-1">
                                    <li>• <b>Q. 연락 스타일:</b> 관계의 밀착도와 불안/회피/안정 애착 유형 분석</li>
                                    <li>• <b>Q. 연락 두절 시 반응:</b> 분리 불안 상황에서의 대처 방식 및 신뢰도 측정</li>
                                    <li>• <b>Q. 사랑의 언어:</b> 친밀감 욕구와 애정 표현 방식 분석 (스킨십 포함)</li>
                                    <li>• <b>Q. 공감과 위로:</b> 정서적 지지(Secure Base) 역할 수행 능력</li>
                                </ul>
                            </div>
                        </div>

                        <div class="theory-box">
                            <span class="theory-title">🏠 가트맨 부부 치료 - 존 가트맨 연구소</span>
                            <p class="mb-2 text-xs text-gray-500">40년간 3,000쌍 이상의 부부를 연구하여 이혼 예측률 94%를 기록한 <b>존 가트맨(John Gottman) 박사</b>의 연구를 반영했습니다.</p>
                            <div class="mt-2 pt-2 border-t border-gray-200">
                                <p class="font-bold text-xs text-indigo-800 mb-1">📌 반영된 핵심 질문:</p>
                                <ul class="list-none space-y-1 text-xs ml-1">
                                    <li>• <b>Q. 싸움 스타일:</b> 갈등 상황에서의 태도와 대응 방식</li>
                                    <li>• <b>Q. 화해 방식:</b> 싸움 후 화해를 위한 시도(Repair Attempt) 방식 분석</li>
                                    <li>• <b>Q. 사과 방식:</b> 관계 회복을 위해 상대가 선호하는 언어적/행동적 접근법</li>
                                    <li>• <b>Q. 논쟁 태도:</b> 관계를 파괴하는 '4가지 독(비난, 방어, 경멸, 담쌓기)' 회피 여부</li>
                                </ul>
                            </div>
                        </div>

                        <div class="theory-box">
                            <span class="theory-title">🖐️ Big 5 성격 특성 - 골드버그 & 코스타</span>
                            <p class="mb-2 text-xs text-gray-500">현대 심리학에서 가장 타당성 높은 성격 모델인 <b>Big 5(개방성, 성실성, 외향성, 우호성, 신경성)</b>를 기반으로 생활 양식을 분석합니다.</p> 
                            <div class="mt-2 pt-2 border-t border-gray-200">
                                <p class="font-bold text-xs text-indigo-800 mb-1">📌 반영된 핵심 질문:</p>
                                <ul class="list-none space-y-1 text-xs ml-1">
                                    <li>• <b>성실성/개방성:</b> 생활 리듬, 위생 관념, 여행 계획 스타일</li>
                                    <li>• <b>외향성/정서안정:</b> 에너지 충전 방식, 주말 활동 선호도, 감정 표출</li>
                                    <li>• <b>현실적 가치관:</b> 경제관, 자녀 계획, 대화 주제, 미래 설계</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h4 class="font-bold text-indigo-600 mb-2 text-lg">3. 유사성-상호보완성 가설</h4>
                        <p>심리학 연구에 따르면, <b>'가치관과 태도'</b>는 유사할수록(Similarity) 갈등이 적고, <b>'행동 양식과 역할'</b>은 상호보완적일수록(Complementarity) 시너지가 납니다. 이 테스트는 '유사성 질문'과 '상호(Crossover) 질문'을 통해 두 가지 요소를 모두 검증합니다.</p>
                    </div>
                </div>

                <div class="mt-8 text-center">
                    <button onclick="closeModal('science-modal')" class="bg-gray-800 text-white px-8 py-3 rounded-lg font-bold hover:bg-gray-900 transition-colors">
                        완벽하게 이해했습니다
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- [NEW] 결과 해석 가이드 모달 (분리형 콘텐츠) -->
    <div id="analysis-guide-modal" class="fixed inset-0 bg-black/50 hidden z-50 flex justify-center items-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-2xl modal-content shadow-2xl transform transition-all scale-95 opacity-0" id="guide-modal-panel">
            <div class="p-8">
                <div class="flex justify-between items-start mb-6">
                    <h3 class="text-2xl font-bold serif-font text-gray-800" id="guide-modal-title">결과 분석 원리 가이드</h3>
                    <button onclick="closeModal('analysis-guide-modal')" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                </div>
                
                <div class="space-y-10 text-sm leading-relaxed text-gray-600">
                    
                    <!-- 섹션 1: 파동 콘텐츠 (기본 숨김) - 유저 친화적 버전 -->
                    <div id="guide-content-resonance" class="hidden">
                        <h4 class="font-bold text-blue-600 mb-4 text-lg flex items-center border-b border-blue-100 pb-2">
                            <span class="text-2xl mr-2">🌊</span> 이 파동은 이런 뜻이에요
                        </h4>
                        <p class="mb-4 text-gray-700">두 분의 성격과 가치관을 파동으로 표현했어요. <b>파동의 모양만 봐도</b> 서로를 이해할 수 있습니다.</p>
                        
                        <div class="bg-blue-50 p-5 rounded-xl border border-blue-100 space-y-4">

                            <!-- 1. 파동 크기 = 에너지 스타일 -->
                            <div class="flex gap-3">
                                <div class="min-w-[40px] text-2xl">⛰️</div>
                                <div>
                                    <span class="font-bold text-blue-900 block mb-1 text-base">파동이 크면? 활발하고 적극적인 커플!</span>
                                    <p class="text-xs text-gray-600 leading-5">
                                        파동이 클수록 두 분은 <b>활동적이고 에너지가 넘치는 스타일</b>이에요.
                                        <br>• <b>파동이 클 때:</b> <span class="text-blue-700">"같이 뭐 하자!"</span> 함께 여행, 도전, 새로운 경험을 즐기는 활력 넘치는 관계
                                        <br>• <b>파동이 잔잔할 때:</b> <span class="text-blue-700">"같이 있는 것만으로 좋아"</span> 조용하고 편안한 휴식 같은 관계
                                    </p>
                                </div>
                            </div>

                            <!-- 2. 파동 빠르기 = 생활 리듬 -->
                            <div class="flex gap-3">
                                <div class="min-w-[40px] text-2xl">🎵</div>
                                <div>
                                    <span class="font-bold text-blue-900 block mb-1 text-base">파동이 빠르면? 즉흥적이고 다이내믹한 커플!</span>
                                    <p class="text-xs text-gray-600 leading-5">
                                        파동이 빠를수록 일상의 변화를 즐기고, 느릴수록 <b>안정된 루틴</b>을 선호해요.
                                        <br>• <b>빠른 파동:</b> <span class="text-amber-600">"오늘 갑자기 여기 갈까?"</span> 즉흥적이고 변화를 즐기는 리듬
                                        <br>• <b>느린 파동:</b> <span class="text-amber-600">"우리 주말 계획 세우자"</span> 계획적이고 여유로운 리듬
                                    </p>
                                </div>
                            </div>

                            <!-- 3. 두 파동의 조화 = 우리의 케미 -->
                            <div class="flex gap-3">
                                <div class="min-w-[40px] text-2xl">💞</div>
                                <div>
                                    <span class="font-bold text-blue-900 block mb-1 text-base">두 파동이 겹치면? 찰떡궁합!</span>
                                    <p class="text-xs text-gray-600 leading-5">
                                        두 분의 파동이 얼마나 비슷하게 움직이는지가 바로 <b>궁합</b>이에요.
                                        <br>• <b>파동이 겹칠 때:</b> <span class="text-rose-600">"말 안 해도 통해!"</span> 생각과 감정이 자연스럽게 일치하는 소울메이트
                                        <br>• <b>파동이 엇갈릴 때:</b> <span class="text-rose-600">"서로 부족한 걸 채워줘!"</span> 나와 다른 매력이 시너지를 만드는 하모니 커플
                                    </p>
                                </div>
                            </div>

                            <!-- 4. 파동 색상 = 대표 매력 (간소화) -->
                            <div class="flex gap-3 border-t border-blue-200 pt-4 mt-2">
                                <div class="min-w-[40px] text-2xl">🎨</div>
                                <div>
                                    <span class="font-bold text-blue-900 block mb-1 text-base">파동 색상 = 나의 대표 매력</span>
                                    <p class="text-xs text-gray-600 mb-2">가장 높은 성격 점수가 파동의 색으로 나타나요.</p>
                                    <div class="grid grid-cols-2 gap-2 text-[11px]">
                                        <span class="flex items-center"><span class="w-3 h-3 rounded-full bg-indigo-500 mr-1"></span><b>보라:</b> 호기심 많은 탐험가</span>
                                        <span class="flex items-center"><span class="w-3 h-3 rounded-full bg-blue-500 mr-1"></span><b>파랑:</b> 믿음직한 계획가</span>
                                        <span class="flex items-center"><span class="w-3 h-3 rounded-full bg-orange-500 mr-1"></span><b>주황:</b> 에너지 넘치는 리더</span>
                                        <span class="flex items-center"><span class="w-3 h-3 rounded-full bg-emerald-500 mr-1"></span><b>초록:</b> 따뜻한 배려의 아이콘</span>
                                        <span class="flex items-center"><span class="w-3 h-3 rounded-full bg-cyan-500 mr-1"></span><b>청록:</b> 흔들리지 않는 든든함</span>
                                        <span class="flex items-center"><span class="w-3 h-3 rounded-full bg-red-400 mr-1"></span><b>빨강:</b> 감성이 풍부한 공감러</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 섹션 2: 레이더 콘텐츠 (기본 숨김) -->
                    <div id="guide-content-radar" class="hidden">
                        <h4 class="font-bold text-purple-600 mb-4 text-lg flex items-center border-b border-purple-100 pb-2">
                            <span class="text-2xl mr-2">📊</span> 8각형 스펙트럼 (Radar) 해석법
                        </h4>
                        <p class="mb-4 text-gray-700">Big 5 성격 이론의 5가지 요인과 애착 이론의 3가지 요인을 결합하여 8가지 축으로 세분화한 <b>성격 지도</b>입니다.</p>
                        
                        <div class="bg-purple-50 p-5 rounded-xl border border-purple-100 space-y-4">
                            <div>
                                <span class="font-bold text-purple-900 block mb-2 text-base">✔️ 그래프 모양의 의미</span>
                                <ul class="list-none text-xs text-gray-600 space-y-3">
                                    <li class="flex items-start">
                                        <span class="text-purple-500 mr-2 mt-1">●</span>
                                        <div>
                                            <b>넓은 면적 (Total Area):</b>
                                            <p class="mt-1">해당 성향 에너지가 전반적으로 풍부함을 의미합니다. 그래프가 클수록 다양한 상황에 유연하게 대처할 수 있는 잠재력이 큽니다.</p>
                                        </div>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-purple-500 mr-2 mt-1">●</span>
                                        <div>
                                            <b>겹치는 영역 (Overlapping Zone):</b>
                                            <p class="mt-1">두 분이 편안하게 소통하고 공감할 수 있는 <b>'안전지대'</b>입니다. 이 영역이 넓을수록 가치관 충돌 없이 평온하며, "우리는 참 비슷하다"고 느끼게 됩니다.</p>
                                        </div>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-purple-500 mr-2 mt-1">●</span>
                                        <div>
                                            <b>튀어나온 영역 (Complementary Zone):</b>
                                            <p class="mt-1">상대방에게는 없지만 나에게만 있는 특별한 매력입니다. 서로 이 부분이 다를 때 <b>'퍼즐 조각'</b>처럼 완벽하게 맞물리는 상호보완 효과가 발생하여, 서로를 성장시켜주는 관계가 됩니다.</p>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                            
                            <div class="bg-white p-4 rounded-lg border border-purple-100 mt-2">
                                <span class="font-bold text-purple-900 block mb-3 text-sm">💡 8가지 성향 축 상세 정의</span>
                                <div class="grid grid-cols-2 gap-x-6 gap-y-3 text-[11px] text-gray-600">
                                    <div class="flex flex-col">
                                        <span class="font-bold text-gray-800">✨ 개방성 (Openness)</span>
                                        <span>새로운 경험, 호기심, 창의성</span>
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="font-bold text-gray-800">📅 성실성 (Conscientiousness)</span>
                                        <span>계획, 책임감, 목표 달성 능력</span>
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="font-bold text-gray-800">🎉 외향성 (Extraversion)</span>
                                        <span>사교성, 활동 에너지, 활력</span>
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="font-bold text-gray-800">🤝 우호성 (Agreeableness)</span>
                                        <span>타인 배려, 공감 능력, 협조성</span>
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="font-bold text-gray-800">🧘 정서안정 (Emotional Stability)</span>
                                        <span>스트레스 관리, 평정심 유지</span>
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="font-bold text-gray-800">🛡️ 애착안정 (Secure)</span>
                                        <span>관계에 대한 신뢰와 편안함</span>
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="font-bold text-gray-800">❤️ 애착불안 (Anxious)</span>
                                        <span>사랑과 관심을 확인받고 싶음</span>
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="font-bold text-gray-800">🌵 애착회피 (Avoidant)</span>
                                        <span>독립적인 시간과 공간 중시</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-8 text-center">
                    <button onclick="closeModal('analysis-guide-modal')" class="bg-gray-800 text-white px-8 py-3 rounded-lg font-bold hover:bg-gray-900 transition-colors shadow-md">
                        확인했습니다
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function getSectionHeaderHTML(section, desc) {
            let icon = '', title = '', sub = '';
            if (section === 'Reptilian') { icon = '🦎'; title = 'Part 1. 본능 & 에너지 (Reptilian)'; sub = '생존 습관과 에너지 레벨'; }
            else if (section === 'Limbic') { icon = '❤️'; title = 'Part 2. 감정 & 애착 (Limbic)'; sub = '사랑, 갈등 해결, 그리고 정서적 유대'; }
            else if (section === 'Neocortex') { icon = '🧠'; title = 'Part 3. 이성 & 가치관 (Neocortex)'; sub = '현실 판단, 미래 계획, 가치관'; }
            return `<div class="section-header"><span class="section-brain-icon">${icon}</span><h3 class="section-title">${title}</h3><p class="section-desc">${desc || sub}</p></div>`;
        }

        function getBadgeHTML(q) {
            if(q.type === 'dynamic') return '<span class="type-badge badge-dynamic">🔥 동적분석</span>';
            if(q.type === 'crossover') return '<span class="type-badge badge-crossover">💞 상호보완</span>';
            if(q.type === 'preference') return '<span class="type-badge badge-preference">⚖️ 가치관</span>';
            return '<span class="type-badge badge-similarity">✨ 유사성</span>';
        }

        /* --- 데이터 (질문 리스트 - Big5 & 애착 반영) --- */
        const questions = [
    /* --- STEP 1. Reptilian Brain (본능/생존/에너지) --- */
    // 1. 수면
    { id: 'q_sleep', section: 'Reptilian', category: '생존 습관', type: 'similarity', text: '당신의 잠자리 예민도는?', options: [ 
        { value: '1', text: '작은 소리나 빛에도 쉽게 깨는 예민한 편이다.', tag: '#신경증'}, 
        { value: '2', text: '적당한 생활 소음이나 빛은 신경 쓰지 않는 편이다.', tag: '#정서안정'}, 
        { value: '3', text: '환경이 바뀌어도 적응하려고 노력하는 편이다.', tag: '#개방성'}, 
        { value: '4', text: '머리만 대면 잠들 정도로 수면 환경에 무던한 편이다.', tag: '#정서안정'} 
    ]},
    // 2. 생활리듬
    { id: 'q_rhythm', section: 'Reptilian', category: '생존 습관', type: 'similarity', text: '선호하는 기상/취침 시간은?', options: [ 
        { value: '1', text: '일찍 자고 일찍 일어나는 아침형 생활을 선호한다.', tag: '#성실성'}, 
        { value: '2', text: '늦게 자고 늦게 일어나는 저녁형 생활이 편하다.', tag: '#개방성'}, 
        { value: '3', text: '상대방이나 상황에 따라 리듬을 맞출 수 있다.', tag: '#우호성'}, 
        { value: '4', text: '정해진 시간 없이 상황에 따라 유동적으로 자는 편이다.', tag: '#개방성'} 
    ]},
    // 3. 위생 (Dynamic)
    { id: 'q_hygiene', section: 'Reptilian', category: '생존 습관', type: 'dynamic', text: '방바닥에 머리카락이 떨어져 있다면?', options: [ 
        { value: '1', text: '보이는 즉시 치워야 직성이 풀리는 성격이다.', tag: '#성실성', followup: { text: '배우자가 어지르면?', options: [{ value: '1', text: '잔소리 폭격' }, { value: '2', text: '따라다니며 치움' }, { value: '3', text: '포기함' }] } }, 
        { value: '2', text: '정해진 시간에 규칙적으로 청소하는 것을 좋아한다.', tag: '#성실성', followup: { text: '청소를 못했다면?', options: [{ value: '1', text: '스트레스 받음' }, { value: '2', text: '내일 몰아서 함' }, { value: '3', text: '괜찮음' }] } }, 
        { value: '3', text: '평소엔 적당히 하고 주말에 몰아서 하는 편이다.', tag: '#개방성', followup: { text: '배우자가 깔끔하면?', options: [{ value: '1', text: '맞추려고 노력' }, { value: '2', text: '피곤함' }, { value: '3', text: '알아서 하라고 둠' }] } }, 
        { value: '4', text: '생활에 지장 없으면 크게 신경 안 쓰는 편이다.', tag: '#정서안정', followup: { text: '집이 엉망이라면?', options: [{ value: '1', text: '언젠간 치우겠지' }, { value: '2', text: '도우미 부름' }, { value: '3', text: '불편하지 않음' }] } } 
    ]},
    // 4. 식성
    { id: 'q_food', section: 'Reptilian', category: '생존 습관', type: 'similarity', text: '데이트 맛집을 고를 때 당신은?', options: [ 
        { value: '1', text: '새로운 음식이나 이색적인 맛집 탐방을 즐기는 편이다.', tag: '#개방성'}, 
        { value: '2', text: '익숙하고 맛이 보장된 단골집이나 검증된 곳을 선호한다.', tag: '#성실성'}, 
        { value: '3', text: '종류를 가리지 않고 그날의 기분에 따라 즐기는 편이다.', tag: '#우호성'}, 
        { value: '4', text: '특별히 가리는 것 없이 상대방의 선택을 따르는 편이다.', tag: '#우호성'} 
    ]},
    // 5. 충전
    { id: 'q_charge', section: 'Reptilian', category: '에너지', type: 'similarity', text: '지친 하루 끝, 나만의 충전 방식은?', options: [ 
        { value: '1', text: '집에서 혼자만의 시간을 가지며 에너지를 채우는 편이다.', tag: '#정서안정'}, 
        { value: '2', text: '사람들을 만나 이야기를 나누며 스트레스를 푸는 편이다.', tag: '#외향성'}, 
        { value: '3', text: '같은 공간에서 각자 할 일을 하며 쉬는 것을 좋아한다.', tag: '#애착안정'}, 
        { value: '4', text: '운동이나 활동적인 취미로 에너지를 발산하는 편이다.', tag: '#외향성'} 
    ]},
    // 6. 주말
    { id: 'q_weekend', section: 'Reptilian', category: '에너지', type: 'similarity', text: '이상적인 주말 데이트 스타일은?', options: [ 
        { value: '1', text: '핫플레이스나 근교 여행 등 밖으로 나가는 것을 좋아한다.', tag: '#외향성'}, 
        { value: '2', text: '집에서 맛있는 것을 먹으며 푹 쉬는 것을 선호한다.', tag: '#정서안정'}, 
        { value: '3', text: '하루는 외출하고 하루는 휴식하며 균형을 맞춘다.', tag: '#성실성'}, 
        { value: '4', text: '각자의 취미 생활을 존중하며 따로 또 같이 보내는 편이다.', tag: '#개방성'} 
    ]},
    // 7. 계획
    { id: 'q_plan', section: 'Reptilian', category: '생활 패턴', type: 'similarity', text: '여행 계획을 짤 때 당신은?', options: [ 
        { value: '1', text: '동선과 시간을 꼼꼼하게 계획하여 움직이는 편이다.', tag: '#성실성'}, 
        { value: '2', text: '큰 틀은 짜되 세부 일정은 상황에 따라 조율하는 편이다.', tag: '#성실성'}, 
        { value: '3', text: '발길 닿는 대로 자유롭게 다니는 즉흥 여행을 즐긴다.', tag: '#개방성'}, 
        { value: '4', text: '계획하기보다 상대방이 이끄는 대로 따르는 게 편하다.', tag: '#우호성'} 
    ]},
    // 8. 사교
    { id: 'q_social_limit', section: 'Reptilian', category: '관계 가치관', type: 'preference', text: '연인의 이성 친구(남사친/여사친), 어디까지 허용?', options: [ 
        { value: '1', text: '이성 친구와 단둘이 만나는 것은 절대 이해할 수 없다.', tag: '#애착불안'}, 
        { value: '2', text: '내가 아는 사람이거나 여럿이 만나는 건 괜찮다고 생각한다.', tag: '#성실성'}, 
        { value: '3', text: '늦은 밤 술자리만 아니라면 믿고 이해해주는 편이다.', tag: '#애착안정'}, 
        { value: '4', text: '각자의 사생활과 인간관계를 존중하고 관여하지 않는다.', tag: '#애착회피'} 
    ]},

    /* --- STEP 2. Limbic System (감정/애착/갈등) --- */
    // 9. 연락
    { id: 'q_contact_style', section: 'Limbic', category: '애착 유형', type: 'crossover', text_me: '나의 연락 스타일은?', text_partner: '상대방에게 바라는 연락 빈도는?', options: [ 
        { value: '1', text: '일상을 실시간으로 공유하고 자주 연락하기를 원한다.', tag: '#애착불안'}, 
        { value: '2', text: '출퇴근이나 식사 등 주요 시점에는 꼭 연락하는 편이다.', tag: '#성실성'}, 
        { value: '3', text: '특별한 용건이 있거나 자기 전에만 통화하면 충분하다.', tag: '#애착회피'}, 
        { value: '4', text: '서로 부담 없이 편할 때 연락하는 걸 선호한다.', tag: '#애착안정'} 
    ]},
    // 10. 부재 (Dynamic)
    { id: 'q_absence', section: 'Limbic', category: '애착 반응', type: 'dynamic', text: '연인이 3시간째 연락 두절이다. 당신의 반응은?', options: [ 
        { value: '1', text: '무슨 일이 생긴 건 아닌지 걱정하며 기다리는 편이다.', tag: '#애착안정', followup: { text: '나중에 연락이 오면?', options: [{ value: '1', text: '별일 없었어?' }, { value: '2', text: '걱정했잖아' }, { value: '3', text: '다음엔 미리 말해줘' }] } }, 
        { value: '2', text: '연락이 올 때까지 불안해하며 수시로 핸드폰을 확인한다.', tag: '#애착불안', followup: { text: '계속 연락이 없으면?', options: [{ value: '1', text: '전화 계속 함' }, { value: '2', text: '카톡 폭탄' }, { value: '3', text: '찾아감' }] } }, 
        { value: '3', text: '메시지를 하나 남겨두고 내 할 일에 집중하는 편이다.', tag: '#애착회피', followup: { text: '이유가 타당하다면?', options: [{ value: '1', text: '쿨하게 넘어감' }, { value: '2', text: '그래도 연락은 해야지' }, { value: '3', text: '알겠어' }] } }, 
        { value: '4', text: '연락이 올 때까지 나도 먼저 연락하지 않는 편이다.', tag: '#애착회피', followup: { text: '상대가 사과하면?', options: [{ value: '1', text: '바로 품' }, { value: '2', text: '시간이 필요함' }, { value: '3', text: '무시함' }] } } 
    ]},
    // 11. 표현
    { id: 'q_expression', section: 'Limbic', category: '사랑의 언어', type: 'crossover', text_me: '내가 사랑받는다고 느끼는 순간은?', text_partner: '연인에게 주로 해주는 표현 방식은?', options: [ 
        { value: '1', text: '따뜻한 말 한마디와 구체적인 칭찬을 들을 때 행복하다.', text_partner: '따뜻한 말 한마디와 구체적인 칭찬을 자주 해주는 편이다.', tag: '#우호성'}, 
        { value: '2', text: '나를 위해 귀찮음을 감수하고 챙겨줄 때 감동한다.', text_partner: '연인을 위해 귀찮음을 감수하고 세심하게 챙겨주는 편이다.', tag: '#성실성'}, 
        { value: '3', text: '눈을 맞추고 온전히 둘만의 시간을 보낼 때 충만하다.', text_partner: '눈을 맞추고 온전히 둘만의 시간을 보내는 데 집중한다.', tag: '#애착안정'}, 
        { value: '4', text: '손잡기, 포옹 등 따뜻한 체온이 닿을 때 안정된다.', text_partner: '먼저 손을 잡거나 안아주며 따뜻한 체온을 나누는 편이다.', tag: '#외향성'} 
    ]},
    // 12. 공감
    { id: 'q_empathy', section: 'Limbic', category: '정서 지지', type: 'crossover', text_me: '힘들 때 받고 싶은 위로는?', text_partner: '연인이 힘들 때 나의 반응은?', options: [ 
        { value: '1', text: '감정적으로 깊이 공감해주고 따뜻하게 위로해주길 바란다.', text_partner: '감정적으로 깊이 공감하며 따뜻하게 위로해주는 편이다.', tag: '#우호성'}, 
        { value: '2', text: '문제 해결을 위한 현실적이고 구체적인 조언을 해주길 바란다.', text_partner: '문제 해결을 위한 현실적인 해결책을 제시하는 편이다.', tag: '#성실성'}, 
        { value: '3', text: '내 이야기를 끊지 않고 끝까지 들어주기를 바란다.', text_partner: '상대의 이야기를 끝까지 경청하고 원할 때 조언한다.', tag: '#애착안정'}, 
        { value: '4', text: '말없이 곁에 있어주거나 기분 전환을 도와주길 바란다.', text_partner: '묵묵히 곁을 지켜주거나 기분 전환을 돕는 편이다.', tag: '#우호성'} 
    ]},
    // 13. 감정 -> 싸움 스타일
    { id: 'q_anger', section: 'Limbic', category: '싸움 스타일', type: 'similarity', text: '연인과 의견 충돌이 있을 때, 주로 어떤 모습으로 싸우나요?', options: [ 
        { value: '1', text: '할 말은 해야 한다. 그 자리에서 불만을 바로 이야기한다.', tag: '#외향성'}, 
        { value: '2', text: '감정이 격해지면 실수가 생길까 봐 잠시 대화를 멈춘다.', tag: '#정서안정'}, 
        { value: '3', text: '감정적인 호소보다는 시시비비를 논리적으로 따지는 편이다.', tag: '#성실성'}, 
        { value: '4', text: '싸우는 상황 자체가 싫어서 입을 다물거나 자리를 피한다.', tag: '#애착회피'} 
    ]},
    // 14. 화해 (New)
    { id: 'q_reconciliation', section: 'Limbic', category: '화해 방식', type: 'dynamic', text: '싸움 후 냉전 상태를 끝내고 싶을 때, 당신의 화해 방식은?', options: [ 
        { value: '1', text: '"우리 얘기 좀 해"라며 먼저 대화를 시도한다.', tag: '#애착안정', followup: { text: '상대가 거부하면?', options: [{ value: '1', text: '기다린다' }, { value: '2', text: '답답하다' }, { value: '3', text: '더 화낸다' }] } }, 
        { value: '2', text: '애교를 부리거나 슬쩍 장난을 치며 분위기를 푼다.', tag: '#우호성', followup: { text: '상대가 정색하면?', options: [{ value: '1', text: '무안하다' }, { value: '2', text: '상처받는다' }, { value: '3', text: '그만둔다' }] } }, 
        { value: '3', text: '좋아하는 음식을 사오거나 선물을 건네는 편이다.', tag: '#외향성', followup: { text: '받지 않으면?', options: [{ value: '1', text: '서운하다' }, { value: '2', text: '화난다' }, { value: '3', text: '다음 기회에' }] } }, 
        { value: '4', text: '상대방 기분이 풀릴 때까지 조용히 기다리는 편이다.', tag: '#애착회피', followup: { text: '너무 오래 걸리면?', options: [{ value: '1', text: '먼저 연락한다' }, { value: '2', text: '계속 기다린다' }, { value: '3', text: '지친다' }] } } 
    ]},
    // 15. 사과
    { id: 'q_apology', section: 'Limbic', category: '갈등 회복', type: 'similarity', text: '진정한 사과라고 느끼는 것은?', options: [ 
        { value: '1', text: '진심이 담긴 사과의 말과 눈빛이 중요하다.', tag: '#우호성'}, 
        { value: '2', text: '앞으로의 다짐과 구체적인 행동 변화를 보여주는 것이다.', tag: '#성실성'}, 
        { value: '3', text: '내 입장을 끝까지 들어주고 공감해주는 태도이다.', tag: '#애착안정'}, 
        { value: '4', text: '기분 전환을 위한 선물이나 맛있는 음식으로 풀어주는 것이다.', tag: '#외향성'} 
    ]},
    // 16. 언쟁
    { id: 'q_argument', section: 'Limbic', category: '대화 방식', type: 'similarity', text: '논쟁 중 상대가 말실수를 했다면?', options: [ 
        { value: '1', text: '잘못된 부분을 짚어주며 논리적으로 반박하는 편이다.', tag: '#성실성'}, 
        { value: '2', text: '상대방의 의도가 무엇인지 차분하게 물어보는 편이다.', tag: '#애착안정'}, 
        { value: '3', text: '농담으로 가볍게 넘기며 경직된 분위기를 푼다.', tag: '#외향성'}, 
        { value: '4', text: '마음에 상처를 입고 입을 다물게 된다.', tag: '#애착불안'} 
    ]},
    // 17. 인내
    { id: 'q_dealbreaker', section: 'Limbic', category: '관계 가치관', type: 'preference', text: '도저히 참을 수 없는 이별 사유는?', options: [ 
        { value: '1', text: '거짓말이나 외도 등 신뢰를 깨뜨리는 행동이다.', tag: '#애착안정'}, 
        { value: '2', text: '욕설이나 비하 등 존중하지 않는 태도와 폭력성이다.', tag: '#우호성'}, 
        { value: '3', text: '대화가 통하지 않고 정서적 교감이 단절되는 것이다.', tag: '#애착불안'}, 
        { value: '4', text: '경제적 무능력이나 도박, 과도한 채무 문제이다.', tag: '#성실성'} 
    ]},

    /* --- STEP 3. Neocortex (이성/가치관/미래) --- */
    // 18. 재무
    { id: 'q_finance', section: 'Neocortex', category: '경제관', type: 'similarity', text: '예상치 못한 목돈이 생겼을 때, 선호하는 자산 운용 방식은?', options: [ 
        { value: '1', text: '주식, 코인 등 기대 수익률이 높은 곳에 과감하게 투자한다.', tag: '#개방성'}, 
        { value: '2', text: '원금이 보장되는 예금이나 적금에 안전하게 넣어둔다.', tag: '#성실성'}, 
        { value: '3', text: '리스크 관리를 위해 안전 자산과 투자 자산에 나누어 관리한다.', tag: '#성실성'}, 
        { value: '4', text: '나를 위한 선물이나 여행 등 값진 경험에 사용한다.', tag: '#외향성'} 
    ]},
    // 19. 관리
    { id: 'q_manage', section: 'Neocortex', category: '경제관', type: 'similarity', text: '결혼 후 수입 관리는?', options: [ 
        { value: '1', text: '각자 수입을 관리하고 생활비만 공통으로 부담한다.', tag: '#개방성'}, 
        { value: '2', text: '한 사람이 전담하여 관리하고 용돈을 받아 쓴다.', tag: '#성실성'}, 
        { value: '3', text: '수입을 모두 합치고 지출 계획을 함께 의논한다.', tag: '#애착안정'}, 
        { value: '4', text: '공동 통장에 생활비를 넣고 나머지는 각자 자유롭게 쓴다.', tag: '#정서안정'} 
    ]},
    // 20. 자녀
    { id: 'q_kids', section: 'Neocortex', category: '가족관', type: 'preference', text: '자녀 계획에 대한 생각은?', options: [ 
        { value: '1', text: '자녀는 행복한 가정을 위해 꼭 필요하다고 생각한다.', tag: '#우호성'}, 
        { value: '2', text: '자녀 없이 부부 둘만의 삶을 즐기고 싶다.', tag: '#개방성'}, 
        { value: '3', text: '있으면 좋지만 없어도 둘이서 충분히 행복할 수 있다.', tag: '#정서안정'}, 
        { value: '4', text: '아이 대신 반려동물과 함께하는 삶을 선호한다.', tag: '#개방성'} 
    ]},
    // 21. 육아
    { id: 'q_parenting', section: 'Neocortex', category: '가족관', type: 'similarity', text: '훈육 스타일, 당신의 선택은?', options: [ 
        { value: '1', text: '예의범절과 규율을 중시하며 엄격하게 키우고 싶다.', tag: '#성실성'}, 
        { value: '2', text: '자유롭게 키우고 싶다.', tag: '#개방성'}, 
        { value: '3', text: '기본 원칙은 지키되 아이의 자율성을 최대한 존중한다.', tag: '#애착안정'}, 
        { value: '4', text: '아이의 재능 계발과 학업 성취를 적극적으로 지원한다.', tag: '#성실성'} 
    ]},
    // 22. 종교
    { id: 'q_religion', section: 'Neocortex', category: '가치관', type: 'preference', text: '종교 활동에 대한 생각은?', options: [ 
        { value: '1', text: '부부가 같은 종교를 갖고 함께 활동하는 것이 중요하다.', tag: '#우호성'}, 
        { value: '2', text: '종교가 달라도 상관없으며 서로의 믿음을 존중한다.', tag: '#개방성'}, 
        { value: '3', text: '둘 다 종교 활동에 얽매이지 않았으면 좋겠다.', tag: '#개방성'}, 
        { value: '4', text: '상대방이 종교에 지나치게 심취하는 것은 부담스럽다.', tag: '#성실성'} 
    ]},
    // 23. 성향
    { id: 'q_topic', section: 'Neocortex', category: '대화 코드', type: 'similarity', text: '평소 가장 즐겨 하는 대화 주제는?', options: [ 
        { value: '1', text: '유머나 가십 등 가볍고 즐거운 이야기를 선호한다.', tag: '#외향성'}, 
        { value: '2', text: '뉴스나 재테크 등 유용한 정보를 나누는 것을 좋아한다.', tag: '#성실성'}, 
        { value: '3', text: '하루 일과나 감정 등 소소한 일상을 나누는 게 좋다.', tag: '#우호성'}, 
        { value: '4', text: '가치관이나 미래에 대해 깊이 있는 대화를 나누고 싶다.', tag: '#개방성'} 
    ]},
    // 24. 노후
    { id: 'q_retirement', section: 'Neocortex', category: '미래 계획', type: 'similarity', text: '은퇴 후 꿈꾸는 삶은?', options: [ 
        { value: '1', text: '공기 좋은 한적한 곳에서 전원생활을 즐기고 싶다.', tag: '#정서안정'}, 
        { value: '2', text: '편의시설이 갖춰진 도심에서 문화생활을 즐기고 싶다.', tag: '#외향성'}, 
        { value: '3', text: '도시와 자연이 적절히 어우러진 근교에서 살고 싶다.', tag: '#성실성'}, 
        { value: '4', text: '낯선 해외에서 살아보거나 이민을 가고 싶다.', tag: '#개방성'} 
    ]}
];
        
        // 8개 성향 축 매핑
        const tagToAxis = {
            '#개방성': '개방성', '#탐구형': '개방성', '#미식': '개방성', '#감각추구': '개방성', '#비전지향': '개방성', '#분리': '개방성', '#위험감수': '개방성', '#효율성': '개방성', '#독립적': '애착회피',
            '#성실성': '성실성', '#규칙준수': '성실성', '#높은성실성': '성실성', '#계획성': '성실성', '#현실적': '성실성', '#능력': '성실성', '#실물자산': '성실성', '#양육집중': '성실성', '#자산가치': '성실성', '#합리적': '성실성', '#성취': '성실성', '#실용주의': '성실성',
            '#외향성': '외향성', '#자극추구': '외향성', '#행동적공감': '외향성', '#높은친밀감': '외향성', '#즐거움': '외향성', '#미래투자': '외향성', '#심미성': '외향성', '#친밀함': '외향성',
            '#우호성': '우호성', '#정서적공감': '우호성', '#관계지향': '우호성', '#통합': '우호성', '#가족확장': '우호성', '#전통적': '우호성', '#가정': '우호성', '#가정적': '우호성', '#요리': '우호성',
            '#정서안정': '정서안정', '#낮은신경증': '정서안정', '#내향성': '정서안정', '#안정추구': '정서안정', '#낮은친밀감': '정서안정', '#유연': '정서안정', '#위험회피': '정서안정', '#자연스러움': '정서안정', '#삶의질': '정서안정', '#안정': '정서안정', '#자기관리': '정서안정', '#무던함': '정서안정',
            '#안정애착': '애착안정', '#애착안정': '애착안정', '#존재적공감': '애착안정', '#중간친밀감': '애착안정',
            '#불안애착': '애착불안', '#정서불안': '애착불안', '#신경증': '애착불안', '#접촉위안': '애착불안',
            '#애착회피': '애착회피'
        };

        const traitColors = {
            '개방성': ['#8B5CF6', '#EDE9FE'], '성실성': ['#3B82F6', '#DBEAFE'], '외향성': ['#F97316', '#FFEDD5'], 
            '우호성': ['#10B981', '#D1FAE5'], '정서안정': ['#06B6D4', '#CFFAFE'], '애착안정': ['#6366F1', '#E0E7FF'], 
            '애착불안': ['#EF4444', '#FEE2E2'], '애착회피': ['#64748B', '#F1F5F9'] 
        };
        
        // [NEW] 성향별 점수 & 순위 기반 동적 설명 (전문가 톤으로 수정됨)
        const traitLevelDescriptions = {
            '개방성': {
                // 1순위일 때 (핵심 정체성)
                dominant: { 
                    label: "🔭 혁신적인 탐험가 (높은 개방성)", 
                    desc: "귀하를 대표하는 키워드는 '통찰'과 '혁신'입니다. 남들이 보지 못하는 가능성을 발견하고, 새로운 경험을 통해 끊임없이 성장하려는 욕구가 매우 강합니다." 
                },
                // 2,3순위일 때 (보조 성향)
                supportive: { 
                    label: "✨ 유연한 수용가 (개방성)", 
                    desc: "열린 사고방식을 가지고 있어 변화에 유연하게 대처합니다. 당신의 다른 강점들에 창의적인 색채를 더해주는 역할을 합니다." 
                }
            },
            '성실성': {
                dominant: { 
                    label: "📅 목표 지향적 설계자 (높은 성실성)", 
                    desc: "귀하의 가장 큰 무기는 '철저함'입니다. 삶의 불확실성을 계획으로 통제하며, 높은 책임감으로 목표를 반드시 달성해내는 성취가입니다." 
                },
                supportive: { 
                    label: "🏃 신뢰할 수 있는 실행가 (성실성)", 
                    desc: "성실함이 귀하의 기반을 단단하게 받쳐줍니다. 맡은 바 책임을 다하는 꾸준함으로 파트너에게 깊은 신뢰와 안정감을 줍니다." 
                }
            },
            '외향성': {
                dominant: { 
                    label: "🗣️ 관계 지향적 리더 (높은 외향성)", 
                    desc: "외부 세계와의 상호작용에서 에너지를 얻는 타입입니다. 적극적인 태도로 관계를 주도하며, 타인에게 긍정적인 활력을 불어넣는 중심인물입니다." 
                },
                supportive: { 
                    label: "☀️ 활력 있는 사교가 (외향성)", 
                    desc: "적당한 사교성을 갖추어 원만한 대인 관계를 형성합니다. 상황에 따라 에너지를 발산하며 분위기를 밝게 만드는 윤활유 역할을 합니다." 
                }
            },
            '우호성': {
                dominant: { 
                    label: "🤝 이타적인 조력자 (높은 우호성)", 
                    desc: "타인에 대한 깊은 이해와 배려심이 귀하의 핵심입니다. 자신의 이익보다 공동체의 조화와 파트너의 행복을 우선시하는 따뜻한 성품을 지녔습니다." 
                },
                supportive: { 
                    label: "🕊️ 온화한 중재자 (우호성)", 
                    desc: "공감 능력이 뛰어나 타인의 감정을 잘 읽습니다. 갈등 상황에서도 부드러운 태도로 관계의 균형을 맞추는 능력이 탁월합니다." 
                }
            },
            '정서안정': {
                dominant: { 
                    label: "⚓️ 흔들림 없는 중심 (높은 정서안정)", 
                    desc: "스트레스 내성이 매우 높고 감정 기복이 적습니다. 어떤 위기 상황에서도 이성적이고 침착하게 대처하여 주변에 강력한 심리적 안정을 제공합니다." 
                },
                supportive: { 
                    label: "🌊 평온한 유지자 (정서안정)", 
                    desc: "쉽게 예민해지지 않는 무던한 성격입니다. 이 성향 덕분에 관계에서 불필요한 감정 소모를 줄이고 편안함을 유지할 수 있습니다." 
                }
            }
        };

        // [NEW] 애착 유형별 설명 (전문가 톤으로 수정됨)
        const attachmentLevelDescriptions = {
            '애착안정': {
                high: { title: "💎 견고한 신뢰형 (단단한 안정형)", desc: "타인에 대한 신뢰와 자신에 대한 긍정이 조화를 이룹니다. 갈등을 회피하지 않고 대화로 해결하며, 정서적으로 가장 성숙하고 안정된 관계를 맺습니다." },
                mid: { title: "🛡️ 안정적 지향형 (안정형)", desc: "관계에서 오는 안정감을 중요시하며, 파트너를 믿고 지지하려 노력합니다. 비교적 편안하고 지속 가능한 연애를 이끌어갑니다." }
            },
            '애착불안': {
                high: { title: "🔥 몰입형 애착 (풍부한 감성형)", desc: "관계에 대한 몰입도가 매우 높고 정서적 유대감을 최우선으로 합니다. 상대방의 감정 변화를 섬세하게 포착하며, 깊고 밀도 높은 사랑을 추구합니다." },
                mid: { title: "🦋 감성적 교감형 (감성형)", desc: "사랑받고 있음을 확인받을 때 큰 행복을 느낍니다. 섬세한 감수성을 지녔으며, 파트너와의 정서적 교류를 통해 안정감을 얻습니다." }
            },
            '애착회피': {
                high: { title: "🦅 독립적 성향 (확실한 독립형)", desc: "자율성과 독립성을 매우 중요하게 여깁니다. 혼자만의 시간을 통해 에너지를 회복하며, 서로 얽매이지 않는 성숙한 거리를 유지하는 관계를 선호합니다." },
                mid: { title: "🌵 신중한 거리두기형 (독립형)", desc: "자신의 영역이 존중받길 원합니다. 너무 빠른 친밀감보다는 천천히 신뢰를 쌓아가며, 서로의 삶을 존중하는 균형 잡힌 관계를 지향합니다." }
            }
        };

        const profileDescriptions = {
            // (기존 Fallback용 설명은 유지하되, 실제 렌더링은 위 객체 사용)
            '개방성': "새로운 경험에 열려있고 창의적이며, 호기심이 많은 타입입니다.",
            '성실성': "목표 지향적이고 계획적이며, 책임감이 강한 신뢰의 아이콘입니다.",
            '외향성': "에너지가 넘치고 사교적이며, 활동을 통해 활력을 얻는 타입입니다.",
            '우호성': "타인을 배려하고 협조적이며, 갈등보다는 평화를 추구하는 따뜻한 사람입니다.",
            '정서안정': "어떤 상황에서도 침착함을 유지하며, 감정 기복이 적어 든든한 버팀목이 됩니다.",
            '애착안정': "관계에서 신뢰가 깊고, 갈등을 대화로 해결하는 안정적인 연애 스타일입니다.",
            '애착불안': "사랑과 관심을 지속적으로 확인받고 싶어하며, 섬세하고 감수성이 풍부합니다.",
            '애착회피': "독립성을 중요하게 생각하며, 혼자만의 시간을 통해 에너지를 충전합니다."
        };
        
        const traitText = {
            life: [
                { min: 90, text: "생활 리듬 찰떡궁합 ⚡️", class: "perfect" },
                { min: 70, text: "비슷해서 편안해요 🛌", class: "good" },
                { min: 50, text: "서로 맞춰가면 돼요 🤝", class: "diff" },
                { min: 0, text: "각자의 영역 존중 🛡️", class: "unique" }
            ],
            love: [
                { min: 90, text: "눈빛만 봐도 통해요 😍", class: "perfect" },
                { min: 70, text: "대화가 잘 통해요 💬", class: "good" },
                { min: 50, text: "이해와 노력이 필요해요 👂", class: "diff" },
                { min: 0, text: "표현 방식이 달라요 📡", class: "unique" }
            ],
            value: [
                { min: 90, text: "미래를 함께 그려요 🔭", class: "perfect" },
                { min: 70, text: "가치관이 비슷해요 ⚖️", class: "good" },
                { min: 50, text: "서로 다름을 배워요 📚", class: "diff" },
                { min: 0, text: "새로운 관점의 발견 💡", class: "unique" }
            ]
        };

        const maleContainer = document.getElementById('male-questions');
        const femaleContainer = document.getElementById('female-questions');

        function renderQuestions() {
            let maleHTML = '', femaleHTML = '';
            let currentSection = '';

            questions.forEach(q => {
                if (q.section !== currentSection) {
                    const headerHTML = getSectionHeaderHTML(q.section, q.desc);
                    maleHTML += headerHTML;
                    femaleHTML += headerHTML;
                    currentSection = q.section;
                }
                maleHTML += createQuestionHTML(q, 'male');
                femaleHTML += createQuestionHTML(q, 'female');
            });
            maleContainer.innerHTML = maleHTML;
            femaleContainer.innerHTML = femaleHTML;
        }

        function createQuestionHTML(q, gender) {
            const badge = getBadgeHTML(q);
            const optionsHTML = q.options.map((opt, idx) => {
                const followupData = opt.followup ? encodeURIComponent(JSON.stringify(opt.followup)) : 'null';
                const onChange = q.type === 'dynamic' ? `onchange="handleDynamic(this, '${q.id}', '${gender}', '${followupData}')"` : '';
                return `<div class="relative mb-2"><input type="radio" name="${q.id}-me-${gender}" value="${opt.value}" data-tag="${opt.tag}" data-text="${opt.text}" id="${q.id}-me-${gender}-${idx}" class="hidden-radio peer" ${onChange}><label for="${q.id}-me-${gender}-${idx}" class="option-label">${opt.text}</label></div>`;
            }).join('');

            let partnerSection = '';
            if (q.type === 'crossover') {
                const partnerOptions = q.options.map((opt, idx) => {
                    // [수정] text_partner가 있으면 그것을 사용, 없으면 기본 text 사용 (Giving 뉘앙스 적용)
                    const optionText = opt.text_partner || opt.text;
                    return `<div class="relative mb-2"><input type="radio" name="${q.id}-partner-${gender}" value="${opt.value}" data-tag="${opt.tag}" data-text="${optionText}" id="${q.id}-partner-${gender}-${idx}" class="hidden-radio peer"><label for="${q.id}-partner-${gender}-${idx}" class="option-label" style="font-size: 0.85rem; padding: 12px; background:#f9f9f9;">${optionText}</label></div>`;
                }).join('');
                partnerSection = `<div class="mt-4 pt-4 border-t border-dashed border-gray-200"><p class="text-xs font-bold text-purple-600 mb-2">Q. ${q.text_partner}</p><div class="grid grid-cols-1 gap-1">${partnerOptions}</div></div>`;
            }

            return `<div class="question-card p-6" id="card-${q.id}-${gender}"><div class="flex justify-between items-center mb-3"><span class="text-xs font-bold text-gray-400 uppercase tracking-wider">${q.category}</span>${badge}</div><h3 class="font-bold text-gray-800 mb-4 text-base leading-snug break-keep">${q.type === 'crossover' ? q.text_me : q.text}</h3><div class="grid grid-cols-1 gap-1">${optionsHTML}</div>${partnerSection}</div>`;
        }

        function handleDynamic(radio, qId, gender, dataStr) {
            const data = JSON.parse(decodeURIComponent(dataStr));
            if (!data) return; // Followup 없음
            
            const card = radio.closest('.question-card');
            const existing = card.querySelector('.dynamic-area');
            if (existing) existing.remove();
            
            const div = document.createElement('div');
            div.className = 'dynamic-area';
            div.innerHTML = `<p class="text-xs font-bold text-amber-700 mb-2">↳ ${data.text}</p><div class="grid grid-cols-1 gap-2">${data.options.map((opt, i) => `<div><input type="radio" name="${qId}-followup-${gender}" value="${opt.value}" id="${qId}-fu-${gender}-${i}" class="hidden-radio peer" data-score="${opt.value==='1'?6:opt.value==='2'?5:4}" data-text="${opt.text}"><label for="${qId}-fu-${gender}-${i}" class="option-label" style="padding:10px; font-size:0.85rem;">${opt.text}</label></div>`).join('')}</div>`;
            card.appendChild(div);
        }

        // 랜덤 버튼 (Fixed with click simulation and delay for dynamic)
        const randomBtn = document.getElementById('random-btn');
        if (randomBtn) {
            randomBtn.addEventListener('click', async () => {
                for (const q of questions) {
                    for (const g of ['male', 'female']) {
                        const inputs = document.querySelectorAll(`input[name="${q.id}-me-${g}"]`);
                        if (inputs.length > 0) {
                            const randIdx = Math.floor(Math.random() * inputs.length);
                            inputs[randIdx].click(); 
                        }
                        if (q.type === 'crossover') {
                            const pInputs = document.querySelectorAll(`input[name="${q.id}-partner-${g}"]`);
                            if (pInputs.length > 0) {
                                const randIdx = Math.floor(Math.random() * pInputs.length);
                                pInputs[randIdx].click();
                            }
                        }
                    }
                    if (q.type === 'dynamic') {
                        await new Promise(resolve => setTimeout(resolve, 10)); 
                        for (const g of ['male', 'female']) {
                            const dynInputs = document.querySelectorAll(`input[name="${q.id}-followup-${g}"]`);
                            if (dynInputs.length > 0) {
                                const randIdx = Math.floor(Math.random() * dynInputs.length);
                                dynInputs[randIdx].click();
                            }
                        }
                    }
                }
            });
        }

        const calculateBtn = document.getElementById('calculate-btn');
        if (calculateBtn) {
            calculateBtn.addEventListener('click', () => {
                let allChecked = true;
                questions.forEach(q => {
                    ['male', 'female'].forEach(g => {
                        const meRadio = document.querySelector(`input[name="${q.id}-me-${g}"]:checked`);
                        if(!meRadio) { 
                            allChecked = false; 
                            document.getElementById(`card-${q.id}-${g}`).classList.add('error'); 
                        } else {
                            document.getElementById(`card-${q.id}-${g}`).classList.remove('error');
                        }
                        
                        if(q.type === 'crossover' && !document.querySelector(`input[name="${q.id}-partner-${g}"]:checked`)) { 
                            allChecked = false; 
                            document.getElementById(`card-${q.id}-${g}`).classList.add('error'); 
                        }

                        // Dynamic question check
                        if(q.type === 'dynamic') {
                            const dynamicArea = document.querySelector(`#card-${q.id}-${g} .dynamic-area`);
                            if (dynamicArea && !dynamicArea.querySelector('input:checked')) {
                                allChecked = false;
                                dynamicArea.closest('.question-card').classList.add('error');
                            }
                        }
                    });
                });
                

                if(!allChecked) { 
                    document.getElementById('warning-message').classList.remove('hidden'); 
                    setTimeout(() => document.getElementById('warning-message').classList.add('hidden'), 3000); 
                    return; 
                }

                const details = { exactMatches: [], diffMatches: [] };
                const themeMatches = { money: 0, love: 0, talk: 0, life: 0, family: 0 };
                const maleAxes = { '개방성':0, '성실성':0, '외향성':0, '우호성':0, '정서안정':0, '애착안정':0, '애착불안':0, '애착회피':0 };
                const femaleAxes = { '개방성':0, '성실성':0, '외향성':0, '우호성':0, '정서안정':0, '애착안정':0, '애착불안':0, '애착회피':0 };
                const attachCounts = { male: { secure:0, anxious:0, avoid:0 }, female: { secure:0, anxious:0, avoid:0 } };
                let totalPoints = 0;
                let catScores = { life: { total: 0, max: 0 }, love: { total: 0, max: 0 }, value: { total: 0, max: 0 } };

                questions.forEach(q => {
                    ['male', 'female'].forEach(gender => {
                        const me = document.querySelector(`input[name="${q.id}-me-${gender}"]:checked`);
                        if (me) {
                            const axis = tagToAxis[me.dataset.tag] || '우호성';
                            const axes = gender === 'male' ? maleAxes : femaleAxes;
                            if (axes[axis] !== undefined) axes[axis]++;
                            // Note: 애착 점수는 Big5 점수와 별도로 합산
                            if (['#불안애착', '#정서불안', '#신경증'].includes(me.dataset.tag)) axes['애착불안']++;
                            if (['#애착회피', '#독립적'].includes(me.dataset.tag)) axes['애착회피']++;
                            if (['#안정애착', '#애착안정'].includes(me.dataset.tag)) axes['애착안정']++;
                        }
                    });

                    const m = document.querySelector(`input[name="${q.id}-me-male"]:checked`);
                    const f = document.querySelector(`input[name="${q.id}-me-female"]:checked`);
                    let m_answer = m ? m.dataset.text : '';
                    let f_answer = f ? f.dataset.text : '';
                    let m_tag = m ? m.dataset.tag : '';
                    let f_tag = f ? f.dataset.tag : '';
                    let m_val = m ? m.value : '';
                    let f_val = f ? f.value : '';
                    let point = 0;
                    let isMatch = false;

                    if (q.type === 'dynamic') {
                        const m_followup = document.querySelector(`input[name="${q.id}-followup-male"]:checked`);
                        const f_followup = document.querySelector(`input[name="${q.id}-followup-female"]:checked`);
                        
                        let m_final_ans = m_answer;
                        let f_final_ans = f_answer;

                        if (m_followup) { m_final_ans = `${m_answer} (대응: ${m_followup.dataset.text})`; }
                        if (f_followup) { f_final_ans = `${f_answer} (대응: ${f_followup.dataset.text})`; }

                        if (m && f && m_followup && f_followup) {
                            if (m.value === f.value && m_followup.value === f_followup.value) { point = 1; isMatch = true; }
                            else if (m.value === f.value || m_followup.value === f_followup.value) { point = 0.5; }
                        } else if (m && f && m.value === f.value) {
                             // Dynamic Question with No Follow-up on selected option (e.g., q_hygiene value 4)
                            point = 1; isMatch = true;
                        }

                        if (isMatch) details.exactMatches.push({ matchType: 'dynamic', questionType: q.type, category: q.category, q: q.text, a: m_final_ans.split(' (대응:')[0] + ' (대응 호흡 일치)' });
                        else if (m && f) details.diffMatches.push({ q: q.text, ma: m_final_ans, fa: f_final_ans });

                    } else if (q.type === 'crossover') {
                        const mp = document.querySelector(`input[name="${q.id}-partner-male"]:checked`);
                        const fp = document.querySelector(`input[name="${q.id}-partner-female"]:checked`);
                        if (m && f && mp && fp) {
                            if (mp.value === f_val && fp.value === m_val) { 
                                point = 1; isMatch = true;
                                details.exactMatches.push({ matchType: 'crossover', questionType: q.type, category: q.category, q: q.text_me.replace('?', ''), a: "서로가 원하는 바를 완벽하게 충족함" }); 
                            } else {
                                if(mp.value === f_val || fp.value === m_val) point = 0.5;
                                details.diffMatches.push({ q: q.text_me, ma: `신랑: ${m_answer} (신부에게 원하는 것: ${mp.dataset.text})`, fa: `신부: ${f_answer} (신랑에게 원하는 것: ${fp.dataset.text})` });
                            }
                        }
                    } else if (m && f) {
                        if (m_val === f_val) { 
                            point = 1; isMatch = true; 
                            details.exactMatches.push({ matchType: 'similarity', questionType: q.type, category: q.category, q: q.text, a: m_answer });
                        } else {
                            if(tagToAxis[m_tag] === tagToAxis[f_tag]) point = 0.5;
                            details.diffMatches.push({ q: q.text, ma: m_answer, fa: f_answer });
                        }
                    }
                    
                    totalPoints += point;
                    if(q.section === 'Reptilian') { catScores.life.total += point; catScores.life.max += 1; }
                    else if(q.section === 'Limbic') { catScores.love.total += point; catScores.love.max += 1; }
                    else if(q.section === 'Neocortex') { catScores.value.total += point; catScores.value.max += 1; }
                    
                    if(isMatch) {
                        // This theme matching logic is based on question ID, not axes. 
                        if(['q_finance', 'q_manage'].includes(q.id)) themeMatches.money++;
                        if(['q_expression', 'q_empathy', 'q_absence', 'q_reconciliation'].includes(q.id)) themeMatches.love++;
                        if(['q_contact_style', 'q_topic', 'q_anger', 'q_apology'].includes(q.id)) themeMatches.talk++;
                        if(['q_sleep', 'q_food', 'q_hygiene', 'q_rhythm', 'q_weekend', 'q_plan'].includes(q.id)) themeMatches.life++;
                        if(['q_kids', 'q_parenting', 'q_religion'].includes(q.id)) themeMatches.family++;
                    }
                });

                const score = Math.min(100, Math.round((totalPoints / 24) * 100)); 
                const lifeScore = Math.round((catScores.life.total / catScores.life.max) * 100) || 0;
                const loveScore = Math.round((catScores.love.total / catScores.love.max) * 100) || 0;
                const valueScore = Math.round((catScores.value.total / catScores.value.max) * 100) || 0;

                showResults({ score, catScores: {life: lifeScore, love: loveScore, value: valueScore}, details, themeMatches, maleAxes, femaleAxes, attachCounts });
            });
        }

        function getMatchType(score, maleAxes, femaleAxes) {
            const axesKeys = ['개방성', '성실성', '외향성', '우호성', '정서안정', '애착안정', '애착불안', '애착회피'];
            const getDom = (axes) => axesKeys.reduce((a, b) => axes[a] > axes[b] ? a : b);
            const mDom = getDom(maleAxes);
            const fDom = getDom(femaleAxes);
            
            const isSimilar = mDom === fDom;
            const totalEnergy = (maleAxes['외향성'] || 0) + (femaleAxes['외향성'] || 0) + (maleAxes['개방성'] || 0) + (femaleAxes['개방성'] || 0);
            const totalStability = (maleAxes['성실성'] || 0) + (femaleAxes['성실성'] || 0) + (maleAxes['정서안정'] || 0) + (femaleAxes['정서안정'] || 0);
            
            if (isSimilar) {
                if (mDom === '외향성' || mDom === '개방성') {
                    return { title: "🔥 열정의 스파크", subtitle: "PASSIONATE SOULS", icon: "🎆", tags: ["#에너지폭발", "#환상의콤비", "#지루할틈없음"], desc: "함께하면 세상이 두 배로 즐거운 열정 커플", color: "#F97316", borderColor: "#FED7AA" };
                }
                if (mDom === '성실성' || mDom === '정서안정') {
                    return { title: "🌳 뿌리 깊은 나무", subtitle: "DEEP ROOTS", icon: "🏞️", tags: ["#안정감", "#신뢰", "#평온함"], desc: "서로에게 가장 든든한 안식처가 되어주는 관계", color: "#059669", borderColor: "#A7F3D0" };
                }
                if (mDom === '우호성' || mDom === '애착안정') {
                    return { title: "🧸 포근한 솜이불", subtitle: "WARM EMBRACE", icon: "🧶", tags: ["#힐링", "#배려왕", "#따뜻함"], desc: "바라만 봐도 마음이 놓이는 치유의 관계", color: "#EAB308", borderColor: "#FDE047" };
                }
                return { title: "🪞 영혼의 데칼코마니", subtitle: "MIRROR IMAGE", icon: "👯", tags: ["#도플갱어", "#소울메이트", "#이심전심"], desc: "말하지 않아도 통하는 거울 같은 사이", color: "#6366F1", borderColor: "#C7D2FE" };
            }

            if ((mDom === '개방성' && fDom === '성실성') || (mDom === '성실성' && fDom === '개방성')) {
                return { title: "🔭 비전과 현실", subtitle: "DREAM & REALITY", icon: "🚀", tags: ["#상호보완", "#최강팀워크", "#성장"], desc: "꿈을 꾸고 현실로 만드는 완벽한 파트너십", color: "#3B82F6", borderColor: "#BFDBFE" };
            }
            if ((mDom === '외향성' && (fDom === '정서안정' || fDom === '성실성')) || ((mDom === '정서안정' || mDom === '성실성') && fDom === '외향성')) {
                return { title: "⚓️ 정적인 닻과 돛", subtitle: "ANCHOR & SAIL", icon: "⛵️", tags: ["#균형", "#이끌어줌", "#받쳐줌"], desc: "나아갈 힘과 머무를 곳이 되어주는 조화", color: "#0EA5E9", borderColor: "#BAE6FD" };
            }
            
            if (totalEnergy > 14) {
                return { title: "🎢 다이내믹 듀오", subtitle: "DYNAMIC ADVENTURE", icon: "🎡", tags: ["#모험", "#스릴", "#활력"], desc: "매일매일이 새로운 시트콤 같은 커플", color: "#EF4444", borderColor: "#FECACA" };
            }
            
            if (totalStability > 14) {
                return { title: "🏰 견고한 성벽", subtitle: "SOLID CASTLE", icon: "🛡️", tags: ["#철벽방어", "#미래지향", "#계획적"], desc: "흔들림 없이 미래를 쌓아가는 전략가들", color: "#4B5563", borderColor: "#E5E7EB" };
            }

            if (score >= 80) return { title: "💎 빛나는 원석", subtitle: "SHINING GEM", icon: "💍", tags: ["#가능성", "#발전", "#소중함"], desc: "갈고 닦을수록 빛이 나는 보석 같은 만남", color: "#EC4899", borderColor: "#FBCFE8" };
            
            return { title: "🌈 다채로운 프리즘", subtitle: "COLORFUL PRISM", icon: "🎨", tags: ["#개성", "#존중", "#새로움"], desc: "서로 다른 색이 만나 아름다운 무지개를 만듭니다", color: "#8B5CF6", borderColor: "#DDD6FE" };
        }
        function getDominantColor(axes) {
            let maxVal = -1;
            let domTrait = '우호성'; 
            const axesKeys = ['개방성', '성실성', '외향성', '우호성', '정서안정', '애착안정', '애착불안', '애착회피'];
            for (const trait of axesKeys) {
                const score = axes[trait] || 0;
                if (score > maxVal) {
                    maxVal = score;
                    domTrait = trait;
                }
            }
            return traitColors[domTrait] || traitColors['우호성'];
        }
        function drawResonanceWave(canvasId, score, maleAxes, femaleAxes, attachCounts) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const wrapper = canvas.parentElement;
            const rect = wrapper.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            canvas.style.width = `${rect.width}px`;
            canvas.style.height = `${rect.height}px`;
            ctx.scale(dpr, dpr);
            const width = rect.width;
            const height = rect.height;
            const centerY = height / 2; 
            const maxAmplitude = (height / 2) - 60; 
            let offset = 0;
            const mColors = getDominantColor(maleAxes); 
            const fColors = getDominantColor(femaleAxes); 
            const calcAmplitude = (axes) => {
                const energyScore = (axes['외향성'] || 0) * 1.2 + (axes['개방성'] || 0) * 0.8 + (axes['애착불안'] || 0) * 0.5;
                return Math.min(maxAmplitude, 15 + (energyScore * 5));
            };
            const ampM = calcAmplitude(maleAxes);
            const ampF = calcAmplitude(femaleAxes);
            const calcFrequency = (axes) => {
                const stabilityScore = (axes['성실성'] || 0) + (axes['정서안정'] || 0) + (axes['애착안정'] || 0) * 1.5;
                return Math.max(0.005, 0.03 - (stabilityScore * 0.002));
            };
            const freqM = calcFrequency(maleAxes);
            const freqF = calcFrequency(femaleAxes);
            const isSynced = score >= 70;
            const phaseDiff = isSynced ? 0.3 : 2.5; 
            function animate() {
                ctx.clearRect(0, 0, width, height);
                ctx.beginPath();
                for (let x = 0; x < width; x++) {
                    const y = centerY + Math.sin(x * freqM + offset) * ampM;
                    ctx.lineTo(x, y);
                }
                const gradM = ctx.createLinearGradient(0, 0, width, 0);
                gradM.addColorStop(0, mColors[1]); 
                gradM.addColorStop(0.5, mColors[0]); 
                gradM.addColorStop(1, mColors[1]); 
                ctx.strokeStyle = gradM;
                ctx.lineWidth = 4;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.shadowBlur = 15;
                ctx.shadowColor = mColors[0];
                ctx.stroke();
                ctx.shadowBlur = 0;
                ctx.beginPath();
                for (let x = 0; x < width; x++) {
                    const y = centerY + Math.sin(x * freqF + offset + phaseDiff) * ampF;
                    ctx.lineTo(x, y);
                }
                const gradF = ctx.createLinearGradient(0, 0, width, 0);
                gradF.addColorStop(0, fColors[1]);
                gradF.addColorStop(0.5, fColors[0]);
                gradF.addColorStop(1, fColors[1]);
                ctx.strokeStyle = gradF;
                ctx.lineWidth = 4;
                ctx.lineCap = 'round';
                ctx.shadowBlur = 15;
                ctx.shadowColor = fColors[0];
                ctx.stroke();
                ctx.shadowBlur = 0;
                offset += 0.03;
                requestAnimationFrame(animate);
            }
            animate();
        }
        function getTextRating(score, type) {
            const texts = traitText[type];
            for (const t of texts) {
                if (score >= t.min) return { text: t.text, class: t.class };
            }
            return { text: "새로운 관점의 발견 💡", class: "unique" }; 
        }

        // [MODIFIED] 솔루션 로직 대폭 확장 (12x3 = 36개 시나리오)
        function renderSolution(catScores, maleAxes, femaleAxes) {
            
            // 1. ✨ 시너지 포인트 (Synergy Point) - 12가지 시나리오
            let synTitle = "";
            let synDesc = "";
            
            // 성향 차이 및 합계 계산
            const gapExtro = Math.abs(maleAxes['외향성'] - femaleAxes['외향성']);
            const gapConsc = Math.abs(maleAxes['성실성'] - femaleAxes['성실성']);
            const gapOpen = Math.abs(maleAxes['개방성'] - femaleAxes['개방성']);
            const sumAgree = maleAxes['우호성'] + femaleAxes['우호성'];
            const sumStable = maleAxes['정서안정'] + femaleAxes['정서안정'];
            const sumNeuro = maleAxes['애착불안'] + femaleAxes['애착불안'];
            const sumConsc = maleAxes['성실성'] + femaleAxes['성실성'];
            const sumOpen = maleAxes['개방성'] + femaleAxes['개방성'];

            // (1) 애착 안정 시너지
            if (maleAxes['애착안정'] >= 3 && femaleAxes['애착안정'] >= 3) {
                synTitle = "단단한 뿌리를 가진 거목 커플";
                synDesc = "두 분의 관계는 깊은 신뢰를 바탕으로 흔들림이 없습니다. 서로가 서로에게 가장 든든한 안전기지(Secure Base)가 되어주며, 어떤 시련도 지혜롭게 이겨낼 수 있습니다.";
            } 
            // (2) 불안 & 회피 보완 (밀당의 균형)
            else if ((maleAxes['애착불안'] >= 3 && femaleAxes['애착회피'] >= 3) || (femaleAxes['애착불안'] >= 3 && maleAxes['애착회피'] >= 3)) {
                synTitle = "자석처럼 끌어당기는 매력";
                synDesc = "서로 다른 애착 성향은 때로 강력한 끌림을 만듭니다. 한 분은 따뜻한 관심을, 다른 한 분은 독립적인 공간을 제공하며 서로에게 필요한 '거리의 미학'을 가르쳐 줄 수 있습니다.";
            }
            // (3) 불안 & 안정 (치유)
            else if ((maleAxes['애착불안'] >= 3 && femaleAxes['애착안정'] >= 3) || (femaleAxes['애착불안'] >= 3 && maleAxes['애착안정'] >= 3)) {
                synTitle = "감성을 감싸주는 따뜻한 둥지";
                synDesc = "섬세한 감수성을 가진 분을 듬직한 파트너가 안아주는 형국입니다. 불안감은 확신으로 바뀌고, 안정감은 설렘으로 바뀌는 긍정적인 순환이 일어납니다.";
            }
            // (4) 회피 & 안정 (존중)
            else if ((maleAxes['애착회피'] >= 3 && femaleAxes['애착안정'] >= 3) || (femaleAxes['애착회피'] >= 3 && maleAxes['애착안정'] >= 3)) {
                synTitle = "기다림과 믿음의 시너지";
                synDesc = "혼자만의 시간이 필요한 파트너를 믿고 기다려주는 배려가 빛납니다. 재촉하지 않는 편안함 속에서 두 분의 관계는 더욱 깊어집니다.";
            }
            // (5) 외향성 차이 (E & I)
            else if (gapExtro >= 2) {
                synTitle = "안과 밖의 완벽한 조화";
                synDesc = "에너지를 발산하는 '태양'과 수렴하는 '달'의 만남입니다. 한 분은 새로운 세상을 보여주고, 한 분은 편안한 휴식을 제공하며 완벽한 에너지 균형을 이룹니다.";
            }
            // (6) 성실성 차이 (J & P)
            else if (gapConsc >= 2) {
                synTitle = "즉흥과 계획의 환상 밸런스";
                synDesc = "꼼꼼한 계획가와 유연한 모험가가 만났습니다. 계획가는 삶의 안정을, 모험가는 일상의 재미를 책임지며 지루할 틈 없는 삶을 만들어갑니다.";
            }
            // (7) 개방성 차이 (N & S)
            else if (gapOpen >= 2) {
                synTitle = "현실과 이상을 잇는 다리";
                synDesc = "한 분은 숲을 보고, 다른 한 분은 나무를 봅니다. 비전을 제시하는 통찰력과 이를 실현하는 실행력이 만나 꿈을 현실로 만드는 강력한 팀이 됩니다.";
            }
            // (8) 우호성 합이 높음
            else if (sumAgree >= 7) {
                synTitle = "갈등 제로, 평화의 아이콘";
                synDesc = "두 분 모두 배려심이 깊어 싸울 일이 거의 없습니다. 서로를 먼저 생각하는 이타적인 마음이 모여, 주변 사람들까지 편안하게 만드는 따뜻한 커플입니다.";
            }
            // (9) 정서안정 합이 높음
            else if (sumStable >= 7) {
                synTitle = "어떤 파도에도 흔들리지 않는 배";
                synDesc = "감정 기복 없이 차분한 두 분은 위기 관리 능력이 탁월합니다. 인생의 큰 파도가 닥쳐도 서로의 손을 잡고 의연하게 헤쳐 나갈 힘이 있습니다.";
            }
            // (10) 성실성 합이 높음
            else if (sumConsc >= 7) {
                synTitle = "성공을 부르는 파워 커플";
                synDesc = "목표 지향적이고 책임감이 강한 두 분이 만나면 시너지가 폭발합니다. 재테크, 커리어 등 현실적인 목표를 함께 성취해 나가는 최고의 파트너입니다.";
            }
            // (11) 개방성 합이 높음
            else if (sumOpen >= 7) {
                synTitle = "끊임없이 성장하는 탐험가들";
                synDesc = "새로운 배움과 경험을 사랑하는 두 분입니다. 함께 취미를 공유하고 지적인 대화를 나누며, 어제보다 오늘 더 성장하는 멋진 관계입니다.";
            }
            // (12) 그 외 (밸런스형)
            else {
                synTitle = "서로를 비추는 맑은 거울";
                synDesc = "모난 곳 없이 둥글둥글하게 어우러지는 관계입니다. 서로의 모습을 있는 그대로 인정하고 존중하며, 물 흐르듯 자연스러운 행복을 만들어갑니다.";
            }

            // 2. 🗣️ 소통의 레시피 (Communication) - 12가지 시나리오
            let talkTitle = "";
            let talkDesc = "";
            const avgStable = (maleAxes['정서안정'] + femaleAxes['정서안정']) / 2;
            const avgAgree = (maleAxes['우호성'] + femaleAxes['우호성']) / 2;
            const avgConsc = (maleAxes['성실성'] + femaleAxes['성실성']) / 2;
            const avgExtro = (maleAxes['외향성'] + femaleAxes['외향성']) / 2;
            const hasAnxious = maleAxes['애착불안'] >= 3 || femaleAxes['애착불안'] >= 3;
            const hasAvoid = maleAxes['애착회피'] >= 3 || femaleAxes['애착회피'] >= 3;

            // (1) 모두 우호성 높음
            if (avgAgree >= 3.5) {
                talkTitle = "마음을 읽어주는 '공감' 대화법";
                talkDesc = "이미 서로를 깊이 이해하고 계시군요. '고마워', '사랑해' 같은 긍정적인 표현을 아끼지 마세요. 말하지 않아도 알 것이라는 생각보다, 표현할수록 행복이 커집니다.";
            } 
            // (2) 모두 성실성 높음 (논리적)
            else if (avgConsc >= 3.5) {
                talkTitle = "핵심을 짚어주는 '솔루션' 대화법";
                talkDesc = "감정적인 하소연보다는 건설적인 해결책을 나누는 것을 즐기시네요. 차분하게 미래 계획을 세우거나 정보를 공유하는 시간이 두 분에게는 최고의 힐링입니다.";
            } 
            // (3) 모두 외향성 높음 (수다)
            else if (avgExtro >= 3.5) {
                talkTitle = "웃음이 끊이지 않는 '티키타카' 대화법";
                talkDesc = "함께 있으면 시간 가는 줄 모르는군요! 유쾌한 농담 속에 가끔은 진지한 속마음을 섞어보세요. 즐거움과 깊이, 두 마리 토끼를 다 잡을 수 있습니다.";
            } 
            // (4) 모두 개방성 높음 (추상적)
            else if (sumOpen >= 7) {
                talkTitle = "상상력을 자극하는 '지적' 대화법";
                talkDesc = "단순한 일상 공유를 넘어, '만약에' 질문이나 철학적인 주제로 대화해 보세요. 서로의 지적 호기심을 채워줄 때 깊은 정신적 교감을 느낍니다.";
            } 
            // (5) 한 명은 논리(T), 한 명은 감정(F)
            else if (Math.abs(maleAxes['우호성'] - femaleAxes['우호성']) >= 2) {
                talkTitle = "이성과 감성의 '통역' 대화법";
                talkDesc = "한 분은 해결책을, 한 분은 공감을 원할 수 있습니다. 대화 전 '지금은 그냥 들어줘' 혹은 '조언이 필요해'라고 원하는 것을 미리 말해주면 오해가 사라집니다.";
            } 
            // (6) 한 명은 말하기(E), 한 명은 듣기(I)
            else if (gapExtro >= 2) {
                talkTitle = "경청과 리액션의 '핑퐁' 대화법";
                talkDesc = "말하기 좋아하는 분은 상대에게 발언권을 주고, 듣기 좋아하는 분은 리액션을 크게 해주세요. 서로의 역할이 조화될 때 대화의 만족도가 높아집니다.";
            } 
            // (7) 애착 불안 성향이 있을 때
            else if (hasAnxious) {
                talkTitle = "따뜻한 확신을 주는 '안심' 대화법";
                talkDesc = "불안함은 사랑의 크기만큼 큽니다. 연락을 미리 해주거나, '사랑해'라고 자주 말해주세요. 사소한 확신의 말들이 관계를 단단하게 지탱합니다.";
            } 
            // (8) 애착 회피 성향이 있을 때
            else if (hasAvoid) {
                talkTitle = "존중과 배려의 'I-Message' 대화법";
                talkDesc = "상대를 비난하기보다 '나는 ~해서 속상해'라고 나의 감정을 주어로 말해주세요. 방어적인 태도를 허물고 서로의 진심에 다가갈 수 있습니다.";
            } 
            // (9) 정서안정이 낮을 때 (예민)
            else if (avgStable < 2) {
                talkTitle = "감정을 식혀주는 '타임아웃' 대화법";
                talkDesc = "감정이 격해질 땐 잠시 대화를 멈추고 산책을 다녀오세요. 감정을 가라앉힌 후 차분하게 이야기하면, 서로에게 상처 주지 않고 문제를 해결할 수 있습니다.";
            } 
            // (10) 정서안정이 높을 때 (차분)
            else if (avgStable >= 3.5) {
                talkTitle = "편안함을 주는 '티타임' 대화법";
                talkDesc = "흥분하지 않고 차분하게 대화하는 것이 두 분의 강점입니다. 따뜻한 차 한 잔과 함께 나누는 담백한 대화가 관계를 길고 깊게 이어줍니다.";
            } 
            // (11) 가치관 충돌 시
            else if (Math.abs(catScores.value - 100) > 30) {
                talkTitle = "다름을 인정하는 '존중' 대화법";
                talkDesc = "가치관의 차이는 틀림이 아닙니다. 상대를 설득하려 하기보다, '당신 생각은 그렇구나'라고 다름을 인정하는 것에서부터 진정한 소통이 시작됩니다.";
            } 
            // (12) 기본 (Default)
            else {
                talkTitle = "서로의 거울이 되어주는 '미러링' 대화법";
                talkDesc = "상대방의 말을 끝까지 경청하고, 그 말을 반복하며 공감해 주세요. '그랬구나', '당신 말이 맞아'라는 한마디가 마법 같은 변화를 만듭니다.";
            }

            // 3. 🎁 추천 모먼트 (Activity) - 12가지 시나리오
            let actTitle = "";
            let actDesc = "";
            
            // 에너지 레벨과 개방성 조합
            const avgOpenScore = (maleAxes['개방성'] + femaleAxes['개방성']) / 2;

            // (1) 고에너지 + 고개방
            if (avgExtro >= 3.5 && avgOpenScore >= 3.5) {
                actTitle = "세상을 누비는 '어드벤처'";
                actDesc = "반복되는 일상은 NO! 해외여행, 테마파크, 패러글라이딩 등 가슴 뛰는 모험을 함께 즐기세요. 새로운 자극이 두 분의 사랑을 더욱 뜨겁게 만듭니다.";
            } 
            // (2) 고에너지 + 저개방 (활동적이나 익숙한 것 선호)
            else if (avgExtro >= 3.5 && avgOpenScore < 2.5) {
                actTitle = "함께 땀 흘리는 '스포츠 챌린지'";
                actDesc = "러닝, 등산, 배드민턴 등 함께 몸을 움직이며 성취감을 공유해 보세요. 건강한 에너지 발산이 관계의 활력이 됩니다.";
            } 
            // (3) 저에너지 + 고개방 (정적이나 호기심 많음)
            else if (avgExtro < 2.5 && avgOpenScore >= 3.5) {
                actTitle = "영감을 채우는 '문화 예술 산책'";
                actDesc = "전시회 관람, 독립 서점 투어, 재즈바 등 감각적인 경험을 공유하세요. 깊이 있는 대화와 함께 서로의 취향을 알아가는 즐거움이 있습니다.";
            } 
            // (4) 저에너지 + 저개방 (집순이/집돌이 + 안정 추구)
            else if (avgExtro < 2.5 && avgOpenScore < 2.5) {
                actTitle = "온전한 휴식을 즐기는 '힐링 스테이'";
                actDesc = "집에서 넷플릭스 보기, 호캉스, 맛있는 배달 음식 등 둘만의 아늑한 공간에서 편안하게 쉬는 것이 최고의 데이트입니다.";
            } 
            // (5) 성실성 높음 (생산적)
            else if (sumConsc >= 7) {
                actTitle = "미래를 함께 그리는 '성장 데이트'";
                actDesc = "재테크 세미나, 자격증 공부, 운동 등 서로의 발전을 돕는 생산적인 활동을 함께 해보세요. 함께 성장하는 기쁨이 사랑을 단단하게 합니다.";
            } 
            // (6) 우호성 높음 (나눔)
            else if (sumAgree >= 7) {
                actTitle = "따뜻함을 나누는 '가치 공유'";
                actDesc = "유기견 봉사활동, 플리마켓 참여, 요리해서 지인 초대하기 등 따뜻한 마음을 나누는 활동이 두 분에게 깊은 충만감을 줍니다.";
            } 
            // (7) 한 명은 E, 한 명은 I
            else if (gapExtro >= 2) {
                actTitle = "자연 속으로 떠나는 '캠핑 & 글램핑'";
                actDesc = "활기찬 야외 활동과 조용한 불멍 타임을 모두 즐길 수 있는 캠핑이 딱입니다. 서로의 속도에 맞춰주는 배려 속에서 낭만이 피어납니다.";
            } 
            // (8) 미식가 성향 (개방성 질문 연동)
            else if (avgOpenScore >= 3) {
                actTitle = "미각을 깨우는 '행복한 미식 투어'";
                actDesc = "숨겨진 맛집 탐방, 와인 테이스팅 등 맛있는 즐거움을 찾아 떠나보세요. 맛있는 음식 앞에서는 그 어떤 이야기도 달콤해집니다.";
            }
            // (9) 정서안정 높음 (차분)
            else if (sumStable >= 7) {
                actTitle = "마음이 맑아지는 '자연 힐링'";
                actDesc = "수목원 산책, 템플 스테이, 등산 등 자연 속에서 맑은 공기를 마시며 리프레시하세요. 고요함 속에서 서로의 소중함을 느낄 수 있습니다.";
            }
            // (10) 호기심 자극
            else if (avgOpenScore >= 3) {
                actTitle = "손끝으로 만드는 '원데이 클래스'";
                actDesc = "도자기 만들기, 향수 공방, 베이킹 등 무언가를 함께 만들어보는 이색 체험을 추천합니다. 함께 만든 결과물은 잊지 못할 추억이 됩니다.";
            }
            // (11) 스트레스 해소 (정서안정 낮음)
            else if (avgStable < 2) {
                actTitle = "스트레스 날리는 '엔터테인먼트'";
                actDesc = "코인 노래방, 오락실, 보드게임 카페 등 신나게 웃고 즐길 수 있는 가벼운 놀이가 필요합니다. 복잡한 생각은 잊고 순간을 즐기세요.";
            }
            // (12) 기본 (Default)
            else {
                actTitle = "소소하지만 확실한 '동네 데이트'";
                actDesc = "동네 맛집 탐방, 공원 산책, 마트 장보기 등 일상적인 데이트도 두 분에게는 특별합니다. 편안함 속에서 피어나는 행복을 만끽하세요.";
            }

            return `
                <div class="solution-card sol-conflict">
                    <div class="sol-icon-circle" style="background: #FEF2F2; color: #DC2626;">✨</div>
                    <div class="sol-title">Synergy Point: ${synTitle}</div>
                    <div class="sol-desc">${synDesc}</div>
                </div>
                <div class="solution-card sol-talk">
                    <div class="sol-icon-circle" style="background: #F0F9FF; color: #0284C7;">🗣️</div>
                    <div class="sol-title">Communication: ${talkTitle}</div>
                    <div class="sol-desc">${talkDesc}</div>
                </div>
                <div class="solution-card sol-date">
                    <div class="sol-icon-circle" style="background: #FFFBEB; color: #D97706;">🎁</div>
                    <div class="sol-title">Activity: ${actTitle}</div>
                    <div class="sol-desc">${actDesc}</div>
                </div>`;
        }

        function analyzePersonalities(maleAxes, femaleAxes, attachCounts) {
            const maleResult = renderPersonalAnalysis('male', maleAxes, attachCounts.male);
            const femaleResult = renderPersonalAnalysis('female', femaleAxes, attachCounts.female);
            const axesKeys = ['개방성', '성실성', '외향성', '우호성', '정서안정', '애착안정', '애착불안', '애착회피'];
            const getDom = (axes) => axesKeys.reduce((a, b) => axes[a] > axes[b] ? a : b);
            const mDom = getDom(maleAxes);
            const fDom = getDom(femaleAxes);
            let chemistry = getChemistryInsight(mDom, fDom);
            return { maleResult, femaleResult, chemistry };
        }
        
        // [MODIFIED] renderPersonalAnalysis with Rank-based Descriptions
        function renderPersonalAnalysis(gender, axes, attachCount) {
            // Big 5 데이터를 배열로 변환
            const big5Keys = ['개방성', '성실성', '외향성', '우호성', '정서안정'];
            const big5 = big5Keys.map(key => ({ id: key, val: axes[key] }));
            
            // 점수 높은 순 정렬
            big5.sort((a, b) => b.val - a.val);
            const top3 = big5.slice(0, 3);

            let top3HTML = '<div class="space-y-3 mb-6">';
            top3HTML += '<h4 class="font-bold text-sm text-gray-500 mb-3 tracking-wide">🏆 성향 분석 리포트 (Top 3)</h4>';
            
            top3.forEach((item, index) => {
                // index가 0이면 1순위(dominant), 1이상이면 보조(supportive)
                const type = (index === 0) ? 'dominant' : 'supportive';
                const info = traitLevelDescriptions[item.id][type];
                
                // 1순위는 조금 더 강조된 스타일
                const containerStyle = index === 0 
                    ? `border-l-4 border-l-${gender === 'male' ? 'blue' : 'pink'}-500 bg-${gender === 'male' ? 'blue' : 'pink'}-50/50` 
                    : `border border-gray-100 bg-white`;

                top3HTML += `
                    <div class="flex items-start p-3 rounded-xl ${containerStyle} shadow-sm transition-all hover:shadow-md">
                        <div class="flex-shrink-0 mr-3 mt-1">
                            <span class="flex items-center justify-center w-6 h-6 rounded-full ${index === 0 ? `bg-${gender === 'male' ? 'blue' : 'pink'}-600 text-white` : 'bg-gray-100 text-gray-500'} text-xs font-bold">
                                ${index + 1}
                            </span>
                        </div>
                        <div>
                            <div class="font-bold text-sm text-gray-800 mb-1 flex items-center">
                                ${info.label}
                                ${index === 0 ? '<span class="ml-2 text-[10px] bg-yellow-100 text-yellow-700 px-1.5 py-0.5 rounded">Core</span>' : ''}
                            </div>
                            <div class="text-xs text-gray-600 leading-relaxed font-light">${info.desc}</div>
                        </div>
                    </div>`;
            });
            top3HTML += '</div>';

            // Determine dominant attachment type and intensity
            const attachScores = [
                { id: '애착안정', val: axes['애착안정'] },
                { id: '애착불안', val: axes['애착불안'] },
                { id: '애착회피', val: axes['애착회피'] }
            ];
            attachScores.sort((a, b) => b.val - a.val);
            const dominantAttach = attachScores[0];
            const attachKey = dominantAttach.id;
            
            // 애착 점수가 높을수록(문항 선택이 많을수록) High 멘트
            const isAttachHigh = dominantAttach.val >= 3; 

            const myAttachInfo = isAttachHigh ? attachmentLevelDescriptions[attachKey].high : attachmentLevelDescriptions[attachKey].mid;
            
            // Determine color style based on attachment type
            let colorClass = '';
            if(attachKey === '애착안정') colorClass = 'bg-emerald-50 text-emerald-900 border-emerald-100';
            else if(attachKey === '애착불안') colorClass = 'bg-rose-50 text-rose-900 border-rose-100';
            else colorClass = 'bg-slate-50 text-slate-700 border-slate-200';

            const attachHTML = `
                <h4 class="font-bold text-sm text-gray-500 mb-3 tracking-wide mt-3">🛡️ 애착 유형 리포트</h4>
                <div class="p-5 rounded-2xl border ${colorClass} relative overflow-hidden mt-3">
                    <div class="absolute top-0 right-0 -mt-2 -mr-2 w-16 h-16 bg-white opacity-20 rounded-full blur-xl"></div>
                    <div class="font-bold text-sm mb-2 flex items-center gap-2 relative z-10">
                        <span class="text-lg"></span>
                        <span>애착 유형: ${myAttachInfo.title}</span>
                    </div>
                    <p class="text-xs leading-relaxed opacity-90 font-medium relative z-10">${myAttachInfo.desc}</p>
                </div>
            `;

            return { statHTML: top3HTML, analysisHTML: attachHTML, attachType: myAttachInfo.title.split(' ')[0], attachBadgeClass: colorClass.split(' ')[0] };
        }

        function getChemistryInsight(mTrait, fTrait) {
            // ... (kept existing logic)
              let title = "서로 다른 매력의 조화";
            let desc = "서로 다른 성향을 가진 두 분이 만났습니다. 처음에는 다름에 끌렸지만, 때로는 그 차이로 인해 오해가 생길 수도 있습니다. 하지만 서로의 방식을 인정하고 존중한다면, 혼자일 때보다 훨씬 더 넓은 세상을 경험하게 될 것입니다.";
            let point = "서로의 부족한 점을 완벽하게 보완해줄 수 있습니다.";
            let caution = "상대방을 내 방식대로 바꾸려 하지 않고 있는 그대로 인정하면 더 큰 시너지가 납니다.";
            if (mTrait === fTrait) {
                if (mTrait === '개방성') {
                    title = "🚀 끊임없이 탐험하는 모험가 커플";
                    desc = "두 분 모두 새로운 경험과 배움을 사랑합니다. 함께 여행을 떠나거나 취미를 공유할 때 최고의 시너지가 납니다. 지루할 틈이 없는 흥미진진한 관계입니다.";
                    point = "함께하는 모든 순간이 새로운 발견이 됩니다.";
                    caution = "현실적인 재정 관리나 루틴을 함께 점검하는 시간을 가지면 더욱 완벽해집니다.";
                } else if (mTrait === '성실성') {
                    title = "🏰 견고한 성을 쌓는 전략가 커플";
                    desc = "두 분 모두 책임감이 강하고 계획적입니다. 경제적 안정과 목표 달성에 있어 타의 추종을 불허하는 강력한 팀워크를 발휘합니다.";
                    point = "함께 미래를 계획하고 실행하는 능력이 탁월합니다.";
                    caution = "가끔은 계획표를 내려놓고 즉흥적인 낭만을 즐기면 관계가 더 부드러워집니다.";
                } else if (mTrait === '외향성') {
                    title = "🎉 세상을 즐기는 에너자이저";
                    desc = "새로운 사람과 환경을 두려워하지 않는 열정적인 커플입니다. 둘이 함께라면 어디서든 주인공이 됩니다. 긍정적인 에너지가 넘칩니다.";
                    point = "지루할 틈 없이 즐거운 연애와 결혼 생활이 가능합니다.";
                    caution = "가끔은 둘만의 차분하고 깊이 있는 대화 시간을 가지면 정서적 유대가 깊어집니다.";
                } else if (mTrait === '우호성') {
                    title = "🏡 따뜻하고 평화로운 안식처";
                    desc = "서로를 배려하고 존중하는 마음이 깊습니다. 갈등이 생겨도 부드럽게 해결하며, 정서적으로 매우 안정된 가정을 꾸릴 수 있습니다.";
                    point = "서로에게 가장 편안한 휴식처가 되어줍니다.";
                    caution = "서운한 점이 있다면 참지 말고 부드럽게 표현하는 연습을 하면 더욱 건강해집니다.";
                } else if (mTrait === '정서안정') {
                    title = "⛰️ 흔들림 없는 태산 같은 커플";
                    desc = "어떤 위기가 와도 당황하지 않고 차분하게 해결해 나갑니다. 서로에게 가장 신뢰할 수 있는 인생의 동반자가 됩니다.";
                    point = "스트레스 상황에서도 서로를 지지하며 굳건하게 버팁니다.";
                    caution = "가끔은 새로운 데이트나 자극을 통해 관계에 활력을 불어넣어 보세요.";
                }
            } 
            else {
                if ((mTrait === '개방성' && fTrait === '성실성') || (mTrait === '성실성' && fTrait === '개방성')) {
                    title = "🔭 비전과 현실의 완벽한 조화";
                    desc = "한 명은 창의적인 아이디어를 내고(개방성), 다른 한 명은 그것을 현실로 구체화합니다(성실성). 꿈을 현실로 만드는 최강의 파트너십입니다.";
                    point = "이상과 현실의 균형을 가장 잘 맞출 수 있는 조합입니다.";
                    caution = "즉흥성과 계획성 사이에서 서로의 스타일을 존중하며 조율해 나가는 지혜가 필요합니다.";
                }
                else if ((mTrait === '개방성' && fTrait === '정서안정') || (mTrait === '정서안정' && fTrait === '개방성')) {
                    title = "⚓️ 자유로운 영혼과 든든한 닻";
                    desc = "한 명이 맘껏 꿈을 펼칠 수 있도록(개방성) 다른 한 명이 든든하게 지지해줍니다(정서안정). 불안함 없이 새로운 도전을 할 수 있는 관계입니다.";
                    point = "도전과 안정이라는 두 마리 토끼를 모두 잡을 수 있습니다.";
                    caution = "안정적인 성향의 파트너가 변화에 적응할 수 있도록 충분한 시간을 주는 배려가 필요합니다.";
                }
                else if ((mTrait === '외향성' && fTrait === '우호성') || (mTrait === '우호성' && fTrait === '외향성')) {
                    title = "☀️ 햇살과 같은 따스함";
                    desc = "활기찬 에너지(외향성)와 따뜻한 배려(우호성)가 만나 주변 사람들까지 기분 좋게 만드는 커플입니다. 사교적이면서도 서로를 챙기는 이상적인 모습입니다.";
                    point = "주변 사람들에게 부러움을 사는 인기 만점 부부가 됩니다.";
                    caution = "바깥 활동을 즐기는 만큼 집안에서의 오붓한 휴식 시간도 균형 있게 챙겨보세요.";
                }
                else if ((mTrait === '외향성' && fTrait === '성실성') || (mTrait === '성실성' && fTrait === '외향성')) {
                    title = "🎤 리더와 참모의 환상 케미";
                    desc = "한 명은 일을 벌리고 추진하며(외향성), 한 명은 수습하고 관리합니다(성실성). 사회적으로 성공할 가능성이 매우 높은 조합입니다.";
                    point = "추진력과 관리 능력이 합쳐져 폭발적인 시너지를 냅니다.";
                    caution = "성실한 파트너가 지치지 않도록, 외향적인 파트너의 세심한 배려와 감사가 더해지면 완벽합니다.";
                }
                else if ((mTrait === '우호성' && fTrait === '성실성') || (mTrait === '성실성' && fTrait === '우호성')) {
                    title = "⚖️ 따뜻함과 올바름의 공존";
                    desc = "규칙과 질서(성실성) 속에 따뜻한 정(우호성)이 넘칩니다. 자녀 양육과 가정 경영에 있어 가장 모범적이고 안정적인 가정을 꾸릴 수 있습니다.";
                    point = "안정적이고 화목한 가정의 표본이 될 수 있습니다.";
                    caution = "때로는 규칙보다 서로의 감정을 우선순위에 두는 유연함을 발휘해 보세요.";
                }
            }
            return `
                <div class="chem-detail-card">
                    <div class="chem-detail-header">
                        <span class="text-2xl">🧪</span>
                        <span>${title}</span>
                    </div>
                    <div class="chem-detail-body">
                        <p class="text-gray-700 leading-relaxed text-sm mb-4">${desc}</p>
                        <div class="chem-point">
                            <b>👍 Synergy Point:</b><br>${point}
                        </div>
                        <div class="chem-advice">
                            <b>🌱 더 완벽해지기:</b><br>${caution}
                        </div>
                    </div>
                </div>
            `;
        }
        function getWaveDescription(score, mAxes, fAxes) {
            // ... (kept existing logic)
             const mEnergy = (mAxes['외향성'] || 0) + (mAxes['개방성'] || 0);
            const fEnergy = (fAxes['외향성'] || 0) + (fAxes['개방성'] || 0);
            const avgEnergy = (mEnergy + fEnergy) / 2;
            const mStable = (mAxes['성실성'] || 0) + (mAxes['정서안정'] || 0);
            const fStable = (fAxes['성실성'] || 0) + (fAxes['정서안정'] || 0);
            const avgStable = (mStable + fStable) / 2;
            const axesKeys = ['개방성', '성실성', '외향성', '우호성', '정서안정', '애착안정', '애착불안', '애착회피'];
            const getDom = (axes) => axesKeys.reduce((a, b) => (axes[a] || 0) > (axes[b] || 0) ? a : b);
            const mDom = getDom(mAxes);
            const fDom = getDom(fAxes);
            const isColorSame = mDom === fDom;
            let mainText = "";
            let subText = "";
            if (score >= 70) {
                if (avgEnergy >= 3.5) {
                    mainText = "두 분의 파장은 <span style='color:#F59E0B'>열정적인 공명(Resonance)</span>을 일으키고 있습니다.";
                    subText = "함께할 때 에너지가 증폭되어 무엇이든 해낼 수 있는 파워풀한 커플입니다.";
                } else if (avgStable >= 3.5) {
                    mainText = "두 분의 리듬은 <span style='color:#3B82F6'>고요한 호수처럼 평온한 동기화</span>를 이룹니다.";
                    subText = "말하지 않아도 통하는 깊은 신뢰와 안정감이 느껴지는 관계입니다.";
                } else {
                    mainText = "두 분의 파장은 <span style='color:#E11D48'>하나의 아름다운 선율</span>처럼 흐르고 있습니다.";
                    subText = "서로가 서로에게 가장 편안하고 자연스러운 안식처가 되어줍니다.";
                }
            } 
            else {
                if (isColorSame) {
                    if (avgEnergy >= 3.5) {
                        mainText = "비슷한 불꽃이 만나 <span style='color:#F59E0B'>더 크고 뜨거운 에너지</span>를 만듭니다.";
                        subText = "서로 너무 닮아서 부딪히기도 하지만, 그만큼 누구보다 서로를 잘 이해할 수 있습니다.";
                    } else {
                        mainText = "비슷한 결을 가진 두 분은 <span style='color:#3B82F6'>깊은 공감대</span>를 형성합니다.";
                        subText = "약간의 방식 차이만 조율한다면, 누구보다 완벽한 소울메이트가 될 수 있습니다.";
                    }
                }
                else { 
                    if (avgEnergy >= 3.5) {
                        mainText = "서로 다른 강렬한 색채가 만나 <span style='color:#F59E0B'>화려한 불꽃</span>을 만들어냅니다.";
                        subText = "지루할 틈 없이 서로에게 끊임없는 자극과 영감을 주는 다이내믹한 관계입니다.";
                    } else {
                        mainText = "서로 다른 리듬이 어우러져 <span style='color:#8B5CF6'>다채로운 변주곡</span>을 연주합니다.";
                        subText = "나와 다른 상대의 세계를 경험하며, 함께 성장하고 넓어지는 특별한 기회입니다.";
                    }
                }
            }
            return `${mainText}<br><span style="display:block; margin-top:8px; font-size: 0.95rem; color: #6B7280; font-weight: 400;">${subText}</span>`;
        }

        function showResults(data) {
            // ... (Existing showResults logic) ...
            window.scrollTo(0, 0);
            document.getElementById('question-section').classList.add('hidden');
            document.getElementById('intro-section').classList.add('hidden');
            document.getElementById('results').classList.remove('hidden');
            document.getElementById('retry-container').classList.remove('hidden');
            document.querySelector('.fixed-bottom-bar .flex.gap-3').classList.add('hidden'); 
            const matchType = getMatchType(data.score, data.maleAxes, data.femaleAxes);
            const matchContainer = document.getElementById('match-type-card-container');
            if (matchContainer) {
                matchContainer.innerHTML = `
                    <div class="match-type-card" style="border-top-color: ${matchType.color}">
                        <div class="match-icon-box"><span>${matchType.icon}</span></div>
                        <h2 class="match-title" style="color:${matchType.color}">${matchType.title}</h2>
                        <p class="match-subtitle">${matchType.subtitle}</p>
                        <div class="match-tags">${matchType.tags.map(tag => `<span class="match-tag-pill">${tag}</span>`).join('')}</div>
                    </div>
                `;
            }
            const titleEl = document.getElementById('couple-title');
            const keywordEl = document.getElementById('result-keyword');
            if (titleEl) titleEl.innerText = matchType.title + " 리포트";
            if (keywordEl) keywordEl.innerText = matchType.desc;
            const mColor = getDominantColor(data.maleAxes);
            const fColor = getDominantColor(data.femaleAxes);
            const mCircle = document.getElementById('result-circle-male');
            const fCircle = document.getElementById('result-circle-female');
            if(mCircle) {
                mCircle.style.background = `linear-gradient(135deg, ${mColor[0]}, ${mColor[1]})`;
                mCircle.style.boxShadow = `0 10px 25px ${mColor[1]}`;
                mCircle.innerHTML = ''; 
            }
            if(fCircle) {
                fCircle.style.background = `linear-gradient(135deg, ${fColor[0]}, ${fColor[1]})`;
                fCircle.style.boxShadow = `0 10px 25px ${fColor[1]}`;
                fCircle.innerHTML = ''; 
            }
            const defs = document.getElementById('connection-defs');
            if(defs) {
                defs.innerHTML = `
                    <linearGradient id="match-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" stop-color="${mColor[0]}" />
                        <stop offset="50%" stop-color="#E2E8F0" />
                        <stop offset="100%" stop-color="${fColor[0]}" />
                    </linearGradient>
                `;
            }
            drawResonanceWave('resonanceWaveCanvas', data.score, data.maleAxes, data.femaleAxes, data.attachCounts);
            const waveDesc = document.getElementById('resonance-desc');
            if(waveDesc) {
                waveDesc.innerHTML = getWaveDescription(data.score, data.maleAxes, data.femaleAxes);
            }
            const updateBar = (id, score, type) => {
                const txt = document.getElementById(`card-${id}-text`);
                const rating = getTextRating(score, type); 
                if (txt) {
                    txt.innerText = rating.text;
                    txt.className = `comp-status ${rating.class}`;
                }
            };
            updateBar('life', data.catScores.life, 'life');
            updateBar('love', data.catScores.love, 'love');
            updateBar('value', data.catScores.value, 'value');
            const badgesEl = document.getElementById('special-badges');
            if (badgesEl) {
                badgesEl.innerHTML = '';
                if(data.themeMatches.money >= 1) badgesEl.innerHTML += `<span class="chem-badge money">💰 경제관 일치</span>`;
                if(data.themeMatches.love >= 1) badgesEl.innerHTML += `<span class="chem-badge love">🔥 뜨거운 사랑</span>`;
                if(data.themeMatches.life >= 1) badgesEl.innerHTML += `<span class="chem-badge life">🛌 생활패턴 찰떡</span>`;
                if(data.themeMatches.talk >= 1) badgesEl.innerHTML += `<span class="chem-badge talk">🗣️ 대화 통함</span>`;
                if(data.themeMatches.family >= 1) badgesEl.innerHTML += `<span class="chem-badge values">🏠 가정적인 커플</span>`;
            }
            const summaryEl = document.getElementById('result-summary');
            if (summaryEl) { 
                summaryEl.innerHTML = `
                    <div class="summary-item"><b>${matchType.title}</b> 유형으로 분석되었습니다.</div>
                    <div class="summary-item">${matchType.desc}의 특징을 가지고 계시네요.</div>
                    <div class="summary-item">서로의 차이를 이해하면 더욱 완벽해질 수 있습니다.</div>
                   `;
            }
            const detailEl = document.getElementById('result-detailed-text');
            const analysisContent = document.getElementById('radar-analysis-content');
            const analysis = analyzePersonalities(data.maleAxes, data.femaleAxes, data.attachCounts);
            const mStat = document.getElementById('male-stat-container'); if(mStat) mStat.innerHTML = analysis.maleResult.statHTML;
            const mText = document.getElementById('male-personal-text'); if(mText) mText.innerHTML = analysis.maleResult.analysisHTML;
            const mBadge = document.getElementById('male-attachment-badge'); 
            if(mBadge) {
                mBadge.innerText = analysis.maleResult.attachType;
                mBadge.className = `text-xs px-2 py-1 rounded-lg font-bold ${analysis.maleResult.attachBadgeClass}`;
            }
            const fStat = document.getElementById('female-stat-container'); if(fStat) fStat.innerHTML = analysis.femaleResult.statHTML;
            const fText = document.getElementById('female-personal-text'); if(fText) fText.innerHTML = analysis.femaleResult.analysisHTML;
            const fBadge = document.getElementById('female-attachment-badge');
            if(fBadge) {
                fBadge.innerText = analysis.femaleResult.attachType;
                fBadge.className = `text-xs px-2 py-1 rounded-lg font-bold ${analysis.femaleResult.attachBadgeClass}`;
            }
            const chemEl = document.getElementById('chemistry-analysis');
            if (chemEl) chemEl.innerHTML = analysis.chemistry;
            const solContainer = document.getElementById('solution-cards-container');
            // **업데이트된 renderSolution 적용**
            if (solContainer) solContainer.innerHTML = renderSolution(data.catScores, data.maleAxes, data.femaleAxes);
            const axesKeys = ['개방성', '성실성', '외향성', '우호성', '정서안정', '애착안정', '애착불안', '애착회피'];
            let totalDiff = 0; axesKeys.forEach(key => { totalDiff += Math.abs(data.maleAxes[key] - data.femaleAxes[key]); });
            let graphType = "", graphDesc = "";
            if (totalDiff <= 5) { graphType = "데칼코마니형 (Decalcomania)"; graphDesc = "두 분의 그래프 개형이 매우 흡사합니다. 서로의 생각과 행동 패턴을 거울처럼 이해할 수 있어 편안함을 느끼지만, 자칫하면 관계가 단조로워질 수 있습니다. 새로운 자극이 필요합니다."; } 
            else if (totalDiff <= 12) { graphType = "상호보완형 (Complementary)"; graphDesc = "일부 영역은 비슷하고 일부는 다릅니다. 서로의 부족한 점을 채워줄 수 있는 가장 이상적인 그래프 형태입니다. 남자의 강점이 여자의 약점을, 여자의 강점이 남자의 약점을 지지해줍니다."; } 
            else { graphType = "다이나믹형 (Dynamic)"; graphDesc = "서로 정반대의 성향이 많아 그래프 모양이 확연히 다릅니다. 초반에는 강한 끌림이 있을 수 있으나, 갈등 발생 시 이해의 노력이 많이 필요합니다. 서로 다른 세계를 인정하는 것이 핵심입니다."; }
            if (analysisContent) {
                analysisContent.innerHTML = `<div class="analysis-item"><span class="analysis-label">📊 그래프 결합도 분석</span><p class="analysis-content"><span class="analysis-highlight">[${graphType}]</span><br>${graphDesc}</p></div><div class="mt-4 p-3 bg-gray-50 rounded-lg text-xs text-gray-600 border border-gray-100"><p>💡 <b>Tip:</b><br>파란색(신랑)과 분홍색(신부) 영역이 겹치는 부분이 넓을수록 가치관 공유가 쉽고, 튀어나온 부분이 서로 다를수록 상호보완적입니다.</p></div>`;
            }

            // [NEW] Card-Based Integrated Match List Logic
            const integratedList = document.getElementById('integrated-match-list');
            if(integratedList) {
                integratedList.innerHTML = '';
                const matchTypeInfo = {
                    'similarity': { label: '⚡️ 취향 일치', class: 'type-similarity' },
                    'crossover': { label: '💞 상호 보완', class: 'type-crossover' },
                    'dynamic': { label: '🔥 찰떡 호흡', class: 'type-dynamic' },
                    'preference': { label: '⚖️ 가치관 공유', class: 'type-preference' }
                };

                // 1. Exact Matches (similarity, crossover, preference, dynamic)
                data.details.exactMatches.forEach(item => {
                    // fallback for undefined questionType (e.g. from legacy logic if any)
                    const qType = item.questionType || 'similarity'; 
                    const info = matchTypeInfo[qType] || matchTypeInfo['similarity'];

                    const div = document.createElement('div');
                    div.className = `match-card ${info.class}`;
                    div.innerHTML = `
                        <div class="match-card-header">
                            <span class="match-badge">${info.label}</span>
                            <span class="text-xs text-gray-400 font-medium ml-auto">${item.category || ''}</span>
                        </div>
                        <div class="match-card-q">Q. ${item.q.replace('?', '')}</div>
                        <div class="match-card-a">${item.a}</div>
                    `;
                    integratedList.appendChild(div);
                });
                
                if(integratedList.children.length === 0) {
                    integratedList.innerHTML = '<div class="text-center text-gray-400 text-sm py-6 bg-gray-50 rounded-xl border border-dashed border-gray-200">일치하는 항목이 없습니다.<br>서로 다름의 미학을 찾아보세요!</div>';
                }
            }

            drawRadar(data.maleAxes, data.femaleAxes);
            
            let finalAdvice = "";
            if(data.score >= 80) finalAdvice = "두 분은 천생연분입니다. 서로의 가치관과 생활 습관이 놀라울 정도로 일치합니다. <br>지금처럼 서로를 존중하며 배려한다면, 어떤 어려움도 함께 이겨낼 수 있는 단단한 가정을 꾸릴 수 있을 것입니다.";
            else if(data.score >= 50) finalAdvice = "두 분은 서로의 부족함을 채워주는 환상의 콤비입니다. <br>몇 가지 차이점이 있지만, 이는 오히려 관계에 활력을 불어넣는 요소가 될 것입니다. 대화를 통해 서로의 다름을 조율해 나가는 과정 자체가 두 분에게 큰 행복이 될 것입니다.";
            else finalAdvice = "두 분은 서로 다른 매력에 끌리는 운명적인 만남입니다. <br>가치관의 차이가 있을 수 있지만, 이는 서로의 세계를 넓혀주는 기회입니다. 상대방의 방식을 '틀림'이 아닌 '다름'으로 인정하고, 서로에게 배우려는 자세를 가진다면 누구보다 다채롭고 흥미로운 결혼 생활을 할 수 있습니다.";
            
            const finalEl = document.getElementById('final-conclusion');
            if(finalEl) finalEl.innerHTML = finalAdvice;
        }

        function renderList(list, id, isPerfect) {
            // Deprecated
        }

        function drawRadar(mA, fA) {
            const ctx = document.getElementById('comparisonRadarChart').getContext('2d');
            if(window.myRadar) window.myRadar.destroy();
            const labels = ['개방성', '성실성', '외향성', '우호성', '정서안정', '애착안정', '애착불안', '애착회피'];
            const mData = labels.map(l => mA[l] || 0); const fData = labels.map(l => fA[l] || 0);

            window.myRadar = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{ label: '남자', data: mData, backgroundColor: 'rgba(93, 125, 154, 0.2)', borderColor: '#5D7D9A', pointBackgroundColor: '#5D7D9A', borderWidth: 2 }, { label: '여자', data: fData, backgroundColor: 'rgba(214, 125, 136, 0.2)', borderColor: '#D67D88', pointBackgroundColor: '#D67D88', borderWidth: 2 }]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { r: { suggestedMin: 0, suggestedMax: 5, pointLabels: { font: { family: "'Noto Serif KR', serif", size: 11, weight: 'bold' }, color: '#444' }, grid: { color: '#e5e7eb' }, angleLines: { color: '#e5e7eb' } } }, plugins: { legend: { position: 'bottom', labels: { usePointStyle: true, padding: 20 } } } }
            });
        }

        function openModal(modalId) { 
            document.getElementById(modalId).classList.remove('hidden'); 
            const panel = document.getElementById(modalId === 'science-modal' ? 'science-modal-panel' : 'guide-modal-panel');
            setTimeout(() => { 
                panel.classList.remove('scale-95', 'opacity-0'); 
                panel.classList.add('scale-100', 'opacity-100'); 
            }, 10); 
        }
        function closeModal(modalId) { 
            const panel = document.getElementById(modalId === 'science-modal' ? 'science-modal-panel' : 'guide-modal-panel');
            panel.classList.add('scale-95', 'opacity-0'); 
            setTimeout(() => { document.getElementById(modalId).classList.add('hidden'); }, 300); 
        }
        
        function openSpecificGuide(type) {
            document.getElementById('analysis-guide-modal').classList.remove('hidden');
            const panel = document.getElementById('guide-modal-panel');
            
            document.getElementById('guide-content-resonance').classList.add('hidden');
            document.getElementById('guide-content-radar').classList.add('hidden');
            
            if (type === 'resonance') {
                document.getElementById('guide-content-resonance').classList.remove('hidden');
                document.getElementById('guide-modal-title').innerText = "🌊 이 파동은 이런 뜻이에요";
            } else {
                document.getElementById('guide-content-radar').classList.remove('hidden');
                document.getElementById('guide-modal-title').innerText = "📊 그래프 해석 상세 가이드";
            }

            setTimeout(() => { 
                panel.classList.remove('scale-95', 'opacity-0'); 
                panel.classList.add('scale-100', 'opacity-100'); 
            }, 10); 
        }

        const retryBtn = document.getElementById('retry-btn');
        if (retryBtn) retryBtn.addEventListener('click', () => location.reload());
        
        renderQuestions();
    </script>
</body>
</html>
